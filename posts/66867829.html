<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;p&gt;Django基础&lt;/p&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Django基础 | Mijm Blog</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 6.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2023-03-08</div></div></div><div class="container post-header"><h1>Django基础</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQLdb-%E5%8F%AA%E9%80%82%E7%94%A8%E4%BA%8Epython2-x%EF%BC%8C%E3%80%82%E5%9C%A8python3-x%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81%E6%98%AF%EF%BC%9A-import-pymysql"><span class="toc-number">3.</span> <span class="toc-text">MySQLdb 只适用于python2.x，。在python3.x的替代品是： import pymysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Django%E7%9A%84%E6%A6%82%E8%A6%81%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">4.</span> <span class="toc-text">一、Django的概要和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Django%E7%9A%84%E6%A6%82%E8%A6%81"><span class="toc-number">4.1.</span> <span class="toc-text">一、Django的概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Django%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.</span> <span class="toc-text">二、Django的安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%92%8CAPP"><span class="toc-number">5.</span> <span class="toc-text">二、创建第一个项目和APP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.1.</span> <span class="toc-text">一、创建第一个项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AAAPP"><span class="toc-number">5.2.</span> <span class="toc-text">二、创建第一个APP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Django%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="toc-number">6.</span> <span class="toc-text">三、Django的运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81APP%E7%9A%84%E6%B3%A8%E5%86%8C"><span class="toc-number">6.1.</span> <span class="toc-text">一、APP的注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99URL%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-number">6.2.</span> <span class="toc-text">二、编写URL和函数的对应关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">三、编写视图函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%90%AF%E5%8A%A8%E6%88%91%E4%BB%AC%E7%9A%84Dajgno%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.4.</span> <span class="toc-text">四、启动我们的Dajgno项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#models%E5%AD%97%E6%AE%B5%EF%BC%8CORM-%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-number">7.</span> <span class="toc-text">models字段，ORM 对象关系映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2asgi-daphne"><span class="toc-number">8.</span> <span class="toc-text">部署asgi daphne</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2uwsgi"><span class="toc-number">9.</span> <span class="toc-text">部署uwsgi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%94%AE"><span class="toc-number">10.</span> <span class="toc-text">外键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWT"><span class="toc-number">11.</span> <span class="toc-text">JWT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DRF"><span class="toc-number">12.</span> <span class="toc-text">DRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django-forms%E4%BD%BF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">django forms使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#celery-redis-%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E5%BC%82%E6%AD%A5%E3%80%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">14.</span> <span class="toc-text">celery + redis 实现任务异步、消息队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django-vue-admin"><span class="toc-number">15.</span> <span class="toc-text">django-vue-admin</span></a></li></ol></details></div><div class="container post-content"><p>Django基础</p>
<span id="more"></span>

<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.0">Doc</a></p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">启动新项目</span><br><span class="line">    django-admin startproject [project_name]</span><br><span class="line"></span><br><span class="line">创建模块</span><br><span class="line">    python manage.py startapp [app_name]</span><br><span class="line">    注册模块</span><br><span class="line">        settings.py 修改 INSTALLED_APPS</span><br><span class="line">    添加路由</span><br><span class="line">        urls.py 添加路由映射</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">    python manage.py runserver</span><br><span class="line"></span><br><span class="line">检查模块是否正常</span><br><span class="line">    python manage.py check [app]</span><br><span class="line"></span><br><span class="line">显示当前设置文件与Django的默认设置之间的差异</span><br><span class="line">    python manage.py diffsettings</span><br><span class="line"></span><br><span class="line">从数据库中删除所有数据</span><br><span class="line">    python manage.py flush</span><br><span class="line"></span><br><span class="line">并更新数据库</span><br><span class="line">    python manage.py makemigrations</span><br><span class="line">    python manage.py migrate</span><br><span class="line"></span><br><span class="line">创建静态文件（STATIC_ROOT变量控制）</span><br><span class="line">    python manage.py collectstatic</span><br><span class="line"></span><br><span class="line">动带有Django环境的Python交互式解释器</span><br><span class="line">    python manage.py shell</span><br><span class="line"></span><br><span class="line">运行所有已安装的app的测试代码</span><br><span class="line">    python manage.py test [test_label [test_label ...]]</span><br><span class="line"></span><br><span class="line">创建超级用户 和 修改密码</span><br><span class="line">    python manage.py createsuperuser</span><br><span class="line">    其他内置命令</span><br><span class="line">        changepassword</span><br><span class="line">        clearsessions</span><br><span class="line">        collectstatic</span><br></pre></td></tr></table></figure>


<h2 id="MySQLdb-只适用于python2-x，。在python3-x的替代品是：-import-pymysql"><a href="#MySQLdb-只适用于python2-x，。在python3-x的替代品是：-import-pymysql" class="headerlink" title="MySQLdb 只适用于python2.x，。在python3.x的替代品是： import pymysql"></a>MySQLdb 只适用于python2.x，。在python3.x的替代品是： import pymysql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">解决办法：</span><br><span class="line"></span><br><span class="line">base.py 文件同目录下的__init__.py文件新增如下两行：</span><br><span class="line"></span><br><span class="line">vi /usr/local/python3/lib/python3.4/site-packages/django/db/backends/mysql/__init__.py</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"></span><br><span class="line">如果还报如下错误：</span><br><span class="line">AttributeError: module &#x27;pymysql&#x27; has no attribute &#x27;install_as_MySQLdb&#x27;</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line">pip uninstall PyMySQL3</span><br><span class="line">pip install -U --force-reinstall pymysql</span><br></pre></td></tr></table></figure>


<h2 id="一、Django的概要和安装"><a href="#一、Django的概要和安装" class="headerlink" title="一、Django的概要和安装"></a>一、Django的概要和安装</h2><h3 id="一、Django的概要"><a href="#一、Django的概要" class="headerlink" title="一、Django的概要"></a>一、Django的概要</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.Django的介绍</span><br><span class="line">    如果你来看这篇文章，想必你一定是正在学习网站开发的后端，或者想要学习网站的后端开发，选择的Django框架作为网站的后端。</span><br><span class="line">    没错，Django正是一个由Python编写的网络框架，可以给开发者便利快捷的开发网站。现在国内有很多大型网站都是使用的Django这个框架，它能够承受高并发。同时，该框架本身就自带了网络安全服务。</span><br><span class="line">    该框架可以在Windows、MacOS、Linux等平台运行。</span><br><span class="line"></span><br><span class="line">2.Django的MTV</span><br><span class="line">    学习Django一定要知道的东西就是MTV。需要知道MTV代表的都是什么含义。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Views：视图。是一个请求处理函数，它就收HTTP请求并返回HTTP响应。试图通过模型访问满足请求所需要的数据，并将相应的格式给模板发去。</span><br><span class="line">    Models：模型。是定义应用程序数据结构的Python对象，并提供在数据库中的管理（GET、POST、PATHCH、DELETE）和查询记录的机制。</span><br><span class="line">    Templates：模板。是定义文件（如html文件）的结构或布局的文件。</span><br><span class="line">    总结</span><br><span class="line"></span><br><span class="line">    Model	Template	View</span><br><span class="line">    负责业务对象和数据库的关系映射（ORM）	负责如何把页面展示给用户（html）	负责业务逻辑，并在适当时候调用Model和Template</span><br></pre></td></tr></table></figure>

<h3 id="二、Django的安装"><a href="#二、Django的安装" class="headerlink" title="二、Django的安装"></a>二、Django的安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Django和Python中其他的模块一样，都是通过pip指令安装。</span><br><span class="line">    pip install django</span><br><span class="line"></span><br><span class="line">查看django的版本</span><br><span class="line">在cmd中输入以下指令：</span><br><span class="line">    python -m django --version</span><br></pre></td></tr></table></figure>

<h2 id="二、创建第一个项目和APP"><a href="#二、创建第一个项目和APP" class="headerlink" title="二、创建第一个项目和APP"></a>二、创建第一个项目和APP</h2><h3 id="一、创建第一个项目"><a href="#一、创建第一个项目" class="headerlink" title="一、创建第一个项目"></a>一、创建第一个项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.创建django项目</span><br><span class="line">    有两种方式可以创建django的项目。</span><br><span class="line">    一种是通过cmd进行创建，一种是通过pycharm直接创建django项目。</span><br><span class="line">    在这里我只介绍一种，就是通过cmd创建django的项目，因为用pycharm创建比较简单，我就不过多介绍。</span><br><span class="line">    首先我们需要知道能够创建django项目的原理。</span><br><span class="line">    我们知道，我们所安装的所有python的模块，都存储在一个python文件下的叫做Scripts的文件夹下。</span><br><span class="line">    我们之所以能够创建django项目，是因为我们安装django的时候，会自动安装一个py文件，叫做django-admin。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    所以我们可以通过django-admin来创建我们的django项目。</span><br><span class="line">    具体方法</span><br><span class="line"></span><br><span class="line">    打开cmd，到指定的目录下。</span><br><span class="line">    输入以下指令：</span><br><span class="line">    django-admin startproject my_first_django</span><br><span class="line">    这样我们就成功的创建了第一个django项目。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.django项目的文件的具体介绍</span><br><span class="line">    我们创建完django项目，发现突然多了好多目录，下面就让我来细致的介绍一些这些py文件的作用。</span><br><span class="line">    首先创建了一个文件夹和manage.py，然后文件夹里创建了好多文件。</span><br><span class="line"></span><br><span class="line">    manage.py</span><br><span class="line"></span><br><span class="line">    这个文件就是关于项目的管理、启动项目、创建APP、数据管理的文件，这个文件一定不要改动，我们经常使用这个文件。</span><br><span class="line"></span><br><span class="line">    文件夹里的文件</span><br><span class="line"></span><br><span class="line">    init.py：基本用不上，不用改动。</span><br><span class="line">    settings.py：关于项目的配置，比如数据库的配置，访问安全检测配置等，常常需要修改。</span><br><span class="line">    urls.py：定义url和函数的对应关系，常常需要修改。</span><br><span class="line">    asgi.py：接受网络请求，主要是异步的请求，不需要改动。</span><br><span class="line">    wsgi.py：接受网络的请求，主要是同步的请求，不需要改动。</span><br></pre></td></tr></table></figure>

<h3 id="二、创建第一个APP"><a href="#二、创建第一个APP" class="headerlink" title="二、创建第一个APP"></a>二、创建第一个APP</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.什么是APP？</span><br><span class="line">    app的全程就是application单词，它的含义是应用，当我们的项目足够大的时候，例如路由或者配置文件、模板文件都写在一起，比较臃肿，因此我们将所有的功能单独分成多个APP来进行开发。</span><br><span class="line">    举个例子：</span><br><span class="line">    比如一个完整的django项目相当于一所大学，那么APP就相当于大学中的各个学院。</span><br><span class="line"></span><br><span class="line">2.创建APP</span><br><span class="line">    首先我们需要知道能够创建django的APP的原理。</span><br><span class="line">    我们需要通过manage.py这个文件来创建我们的APP。</span><br><span class="line">    具体方法</span><br><span class="line"></span><br><span class="line">    打开cmd（到我的项目的目录下）</span><br><span class="line">    输入以下cmd指令：</span><br><span class="line">    python manage.py startapp app01</span><br><span class="line">    这样我们的app就创建成功了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.APP的文件的具体介绍</span><br><span class="line">    创建完的app，发现又多了好多文件，所以我来介绍以下APP目录下的文件的作用。</span><br><span class="line"></span><br><span class="line">    apps.py：固定的，不用改动。用于app的启动的类。</span><br><span class="line">    migrations：固定的，不用改动。做数据库的字段变更记录的。</span><br><span class="line">    test.py：固定的，不用改动，做单元测试的。</span><br><span class="line">    admin.py：固定的，不用改动。django默认提供了admin后台管理。</span><br><span class="line">    models.py： 对数据库进行操作。</span><br><span class="line">    view.py： 定义url调用的函数。</span><br></pre></td></tr></table></figure>

<h2 id="三、Django的运行"><a href="#三、Django的运行" class="headerlink" title="三、Django的运行"></a>三、Django的运行</h2><h3 id="一、APP的注册"><a href="#一、APP的注册" class="headerlink" title="一、APP的注册"></a>一、APP的注册</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">前面讲到，我们虽然已经成功的注册了django的项目和app，但是我们的app现在仍然不能够使用，所以我们需要注册APP才可以正常使用。</span><br><span class="line">具体方法</span><br><span class="line"></span><br><span class="line">转到项目的settings文件下。</span><br><span class="line"></span><br><span class="line">找到INSTALLED_APPS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">将我们注册好的APP存放到这里。</span><br><span class="line"></span><br><span class="line">这样，我们的APP注册工作就完成了。</span><br></pre></td></tr></table></figure>

<h3 id="二、编写URL和函数的对应关系"><a href="#二、编写URL和函数的对应关系" class="headerlink" title="二、编写URL和函数的对应关系"></a>二、编写URL和函数的对应关系</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们首先需要在urls文件里创建我们的链接，也就是访问时的路径。那么我们通过什么来连接起来呢？通过定义函数，也就是说用户访问我们定义好的链接之后，用户会执行我们定义好的函数。</span><br></pre></td></tr></table></figure>


<h3 id="三、编写视图函数"><a href="#三、编写视图函数" class="headerlink" title="三、编写视图函数"></a>三、编写视图函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">现在我们就需要编写我们的视图函数了，需要在views文件里来定义我们的函数的具体内容。</span><br></pre></td></tr></table></figure>


<h3 id="四、启动我们的Dajgno项目"><a href="#四、启动我们的Dajgno项目" class="headerlink" title="四、启动我们的Dajgno项目"></a>四、启动我们的Dajgno项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">有两种方式，一种是命令行启动，一种是通过pycharm来进行启动。下面我只介绍命令行启动的方式，因为我比较喜欢这种启动方式。</span><br><span class="line">具体步骤</span><br><span class="line"></span><br><span class="line">打开cmd，到项目的目录下。</span><br><span class="line">输入以下指令：</span><br><span class="line">python manage.py runserver</span><br><span class="line"></span><br><span class="line">为什么会这样呢？</span><br><span class="line">仔细以看，原来是我们访问的网址不对，刚才我们编写的是index/的页面，所以我们需要访问到index/的页面才可以正常的显示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这样我们的django项目就运行起来了。</span><br></pre></td></tr></table></figure>

<h2 id="models字段，ORM-对象关系映射"><a href="#models字段，ORM-对象关系映射" class="headerlink" title="models字段，ORM 对象关系映射"></a>models字段，ORM 对象关系映射</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line">功能：根据对象的类型生成表结构，</span><br><span class="line">将表结构转换为数据库语句，将数据库结果转换为对象或者表</span><br><span class="line"></span><br><span class="line">优点：极大的简化了编程人员的工作量，统一了代码编写。</span><br><span class="line"></span><br><span class="line">模型、属性和表、字段间的关系：一个模型对应一张表，该模型中的属性对应该模型表的字段</span><br><span class="line"></span><br><span class="line">注意：django会自动的给每一张表设定主键，当人为的设定逐渐后django就不会添加主键</span><br><span class="line">属性的命名规则：python的关键字标识符，连续的下划线不可以为属性名称</span><br><span class="line"></span><br><span class="line">使用流程</span><br><span class="line"></span><br><span class="line">库的导入</span><br><span class="line">    django中定义的属性和模型都存放在django.db.models.files的目录下，伪类方便使用</span><br><span class="line">被导入到django.db.models中</span><br><span class="line">    使用方式：from django.db import models</span><br><span class="line"></span><br><span class="line">数据的逻辑删除</span><br><span class="line">    对于重要的数据我们一般定义逻辑删除，定义字段isdelete，默认属性为False</span><br><span class="line"></span><br><span class="line">字段类型</span><br><span class="line">    AutoField   一个自动增加的整数类型字段。通常你不需要自己编写它，</span><br><span class="line">        Django会自动帮你添加字段：id = models.AutoField(primary_key=True)，</span><br><span class="line">        这是一个自增字段，从1开始计数。如果你非要自己设置主键，</span><br><span class="line">        那么请务必将字段设置为primary_key=True。</span><br><span class="line">        Django在一个模型中只允许有一个自增字段，并且该字段必须为主键！</span><br><span class="line"></span><br><span class="line">    BigAutoField    (1.10新增)64位整数类型自增字段，数字范围更大，从1到9223372036854775807</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ForeignKey      外键，关联其他的表</span><br><span class="line"></span><br><span class="line">    CharField(max_length= n) 字符串字段，可以设定最大长度。表单textinput类型</span><br><span class="line"></span><br><span class="line">    TextField   大量文本内容，在HTML中表现为Textarea标签，最常用的字段类型之一！</span><br><span class="line">        如果你为它设置一个max_length参数，那么在前端页面中会受到输入字符数量限制，</span><br><span class="line">        然而在模型和数据库层面却不受影响。只有CharField才能同时作用于两者。</span><br><span class="line"></span><br><span class="line">    IntegerField</span><br><span class="line">        整数类型，最常用的字段之一。取值范围-2147483648到2147483647。在HTML中表现为NumberInput标签。</span><br><span class="line"></span><br><span class="line">    DecimalField</span><br><span class="line">        固定精度的十进制小数。相当于Python的Decimal实例，必须提供两个指定的参数！参数max_digits：数值最大的总位数，</span><br><span class="line">        必须大于或等于小数点位数 。decimal_places：小数点位数，精度。 当localize=False时，它在HTML表现NumberInput标签，</span><br><span class="line">        否则是text类型。例子：储存最大不超过999，带有2位小数位精度的数，</span><br><span class="line">        定义如下：models.DecimalField(..., max_digits=5, decimal_places=2)。</span><br><span class="line"></span><br><span class="line">    FloatField</span><br><span class="line">        浮点数类型，参考整数类型</span><br><span class="line"></span><br><span class="line">    BooleanField</span><br><span class="line">        布尔值类型。在HTML表单中体现为CheckboxInput标签。如果要接收null值，</span><br><span class="line">        请使用NullBooleanField。</span><br><span class="line"></span><br><span class="line">    NullBooleanField</span><br><span class="line">        类似布尔字段，只不过额外允许NULL作为选项之一。</span><br><span class="line"></span><br><span class="line">    DateField</span><br><span class="line">        class DateField(auto_now=False, auto_now_add=False, **options)日期类型。</span><br><span class="line">        一个Python中的datetime.date的实例。在HTML中表现为TextInput标签。在admin后台中，</span><br><span class="line">        Django会帮你自动添加一个JS的日历表和一个“Today”快捷方式，以及附加的日期合法性验证。</span><br><span class="line">        两个重要参数：（参数互斥，不能共存） auto_now:每当对象被保存时将字段设为当前日期，</span><br><span class="line">        常用于保存最后修改时间。auto_now_add：每当对象被创建时，设为当前日期，常用于保存创建日期(注意，它是不可修改的)。</span><br><span class="line">        设置上面两个参数就相当于给field添加了editable=False和blank=True属性。如果想具有修改属性，请用default参数。</span><br><span class="line">        例子：pub_time = models.DateField(auto_now_add=True)，自动添加发布时间。</span><br><span class="line"></span><br><span class="line">    TimeField</span><br><span class="line">        时间字段，Python中datetime.time的实例。接收同DateField一样的参数，只作用于小时、分和秒。</span><br><span class="line"></span><br><span class="line">    DateTimeField</span><br><span class="line">        日期时间类型。Python的datetime.datetime的实例。与DateField相比就是多了小时、分和秒的显示，</span><br><span class="line">        其它功能、参数、用法、默认值等等都一样。</span><br><span class="line"></span><br><span class="line">    FileField</span><br><span class="line">        class FileField(upload_to=None, max_length=100, **options)上传文件类型，后面单独介绍。</span><br><span class="line"></span><br><span class="line">    ImageField</span><br><span class="line">        图像类型</span><br><span class="line"></span><br><span class="line">    FilePathField</span><br><span class="line">        文件路径类型</span><br><span class="line">        class MyModel(models.Model):</span><br><span class="line">        # 文件被传至`MEDIA_ROOT/uploads`目录，MEDIA_ROOT由你在settings文件中设置</span><br><span class="line">        upload = models.FileField(upload_to=&#x27;uploads/&#x27;)</span><br><span class="line">        # 或者</span><br><span class="line">        # 被传到`MEDIA_ROOT/uploads/2015/01/30`目录，增加了一个时间划分</span><br><span class="line">        upload = models.FileField(upload_to=&#x27;uploads/%Y/%m/%d/&#x27;)</span><br><span class="line">        使用FileField或者ImageField字段的步骤：</span><br><span class="line">        在settings文件中，配置MEDIA_ROOT，作为你上传文件在服务器中的基本路径（为了性能考虑，这些文件不会被储存在数据库中）。</span><br><span class="line">        再配置个MEDIA_URL，作为公用URL，指向上传文件的基本路径。请确保Web服务器的用户账号对该目录具有写的权限。</span><br><span class="line">        添加FileField或者ImageField字段到你的模型中，定义好upload_to参数，文件最终会放在MEDIA_ROOT目录的“upload_to”子目录中。</span><br><span class="line">        所有真正被保存在数据库中的，只是指向你上传文件路径的字符串而已。可以通过url属性，在Django的模板中方便的访问这些文件。</span><br><span class="line">        例如，假设你有一个ImageField字段，名叫mug_shot，那么在Django模板的HTML文件中，可以使用&#123;&#123; object.mug_shot.url &#125;&#125;</span><br><span class="line">        来获取该文件。其中的object用你具体的对象名称代替。</span><br><span class="line">        可以通过name和size属性，获取文件的名称和大小信息。</span><br><span class="line">        安全建议</span><br><span class="line">        无论你如何保存上传的文件，一定要注意他们的内容和格式，避免安全漏洞！务必对所有的上传文件进行安全检查，</span><br><span class="line">        确保它们不出问题！如果你不加任何检查就盲目的让任何人上传文件到你的服务器文档根目录内，比如上传了一个CGI或者PHP脚本，</span><br><span class="line">        很可能就会被访问的用户执行，这具有致命的危害。</span><br><span class="line">    GenericIPAddressField</span><br><span class="line">        class GenericIPAddressField(protocol=&#x27;both&#x27;, unpack_ipv4=False, **options)[source],IPV4或者IPV6地址，</span><br><span class="line">        字符串形式，例如192.0.2.30或者2a02:42fe::4在HTML中表现为TextInput标签。</span><br><span class="line">        参数protocol默认值为‘both’，可选‘IPv4’或者‘IPv6’，表示你的IP地址类型。</span><br><span class="line"></span><br><span class="line">    PositiveIntegerField</span><br><span class="line">        正整数字段，包含0,最大2147483647。</span><br><span class="line">    PositiveSmallIntegerField</span><br><span class="line">        较小的正整数字段，从0到32767。</span><br><span class="line">    SlugField</span><br><span class="line">        slug是一个新闻行业的术语。一个slug就是一个某种东西的简短标签，包含字母、数字、下划线或者连接线，</span><br><span class="line">        通常用于URLs中。可以设置max_length参数，默认为50。</span><br><span class="line">    SmallIntegerField</span><br><span class="line">        小整数，包含-32768到32767。</span><br><span class="line"></span><br><span class="line">    URLField</span><br><span class="line">        一个用于保存URL地址的字符串类型，默认最大长度200。</span><br><span class="line">    UUIDField</span><br><span class="line">        用于保存通用唯一识别码（Universally Unique Identifier）的字段。使用Python的UUID类。</span><br><span class="line">        在PostgreSQL数据库中保存为uuid类型，</span><br><span class="line">        其它数据库中为char(32)。这个字段是自增主键的最佳替代品。</span><br><span class="line"></span><br><span class="line">    注：CHOICES</span><br><span class="line">        SEX_CHOICES = (</span><br><span class="line">            (0, &quot;男&quot;),</span><br><span class="line">            (1, &quot;女&quot;),</span><br><span class="line">        )</span><br><span class="line">        sex = models.IntegerField(choices=SEX_CHOICES, default=0, verbose_name=&quot;性别&quot;)</span><br><span class="line"></span><br><span class="line">字段选项</span><br><span class="line">    null= 为True 空值，储存到数据库中null 默认值False</span><br><span class="line">    blank= 为True，允许空白默认值为false</span><br><span class="line">    db_column= string更改属性在数据表中的名称</span><br><span class="line">    db_index=  True添加一个索引</span><br><span class="line">    default   默认值</span><br><span class="line">    primary_key 主键</span><br><span class="line">    unique  唯一值，不可相同</span><br><span class="line"></span><br><span class="line">关系</span><br><span class="line">    ForeignKey  一对多关系，定义在多的一方</span><br><span class="line">    ManyToManyField 多对多关系，定义在第三方表</span><br><span class="line">    OneToOneField 一对一关系，定义在任意一方即可</span><br><span class="line"></span><br><span class="line">一访问多</span><br><span class="line">    对象名.小写模型名_set</span><br><span class="line">    grades.students_set</span><br><span class="line"></span><br><span class="line">一访问一</span><br><span class="line">    对象名.小写模型名</span><br><span class="line">    grades.student</span><br><span class="line"></span><br><span class="line">访问id值</span><br><span class="line">    对象名.属性_id</span><br><span class="line">    grades.students_id</span><br><span class="line"></span><br><span class="line">元类选项</span><br><span class="line">    定义class Meta：</span><br><span class="line">        类定义属性db_table = string 更改表名</span><br><span class="line">        排序属性ordering = [&#x27;id&#x27;] 默认为升序 -id为降序</span><br><span class="line">    注意：ordering会增加数据库的开销</span><br><span class="line"></span><br><span class="line">模型成员之管理器</span><br><span class="line">    类属性 objects 是一个manager对象与数据库交互数据</span><br><span class="line">    当没有定义管理器的时候django会为模型添加objects管理器</span><br><span class="line"></span><br><span class="line">    自定义管理器：</span><br><span class="line">        定义后django就不会创建objects对象</span><br><span class="line">        stuobj = models.Manager()</span><br><span class="line">        作用：</span><br><span class="line">        1.添加新的方法</span><br><span class="line">        2.修改原始查询数据，重写get_queryset()方法</span><br><span class="line">            # 重写模型管理器对象方法</span><br><span class="line">            class StudentManager(models.Manager):</span><br><span class="line">                # 重新定义查询函数，保留isdelete=false的数据</span><br><span class="line">                def get_queryset(self):</span><br><span class="line">                    return super(StudentManager, self).get_queryset().\</span><br><span class="line">                        filter(isdelete= False)</span><br><span class="line">            class Students(models.Model):</span><br><span class="line">                # 创建stuobj管理器</span><br><span class="line">                stuobj = models.Manager()</span><br><span class="line">                stuobj2 = StudentManager()</span><br><span class="line"></span><br><span class="line">创建对象</span><br><span class="line">    功能：向数据库中添加数据，创建对象不会向数据库添加数据，调用save()才会添加数据</span><br><span class="line">    __init__在父类models.Model中使用，自定义对象不可使用</span><br><span class="line"></span><br><span class="line">创建方法</span><br><span class="line">    模型中添加一个类方法</span><br><span class="line">        #     创建类方法,添加类数据</span><br><span class="line">        @classmethod</span><br><span class="line">        def createStudent(cls, sname, sage, sgender, sbirth, sgrade, isdelete= False):</span><br><span class="line">            stu = cls(name= sname, age= sage, gender= sgender, birth= sbirth,</span><br><span class="line">                      grade= sgrade, isdelete= isdelete)</span><br><span class="line">            stu.save()</span><br><span class="line">        再到views.py文件中定义相关的功能函数</span><br><span class="line">            # 调用类方法添加属性</span><br><span class="line">            def addstudent(myrequest):</span><br><span class="line">               grade = Grades.objects.get(pk= 1)</span><br><span class="line">               Students.createStudent(&#x27;lilei&#x27;,20,True,&#x27;1989-11-15 08:30:33&#x27;, grade)</span><br><span class="line">               return HttpResponse(&quot;Successfully !&quot;)</span><br><span class="line">    定义管理器中添加一个方法</span><br><span class="line">            # 重写模型管理器对象</span><br><span class="line">            class StudentManager(models.Manager):</span><br><span class="line">                # 重新定义查询函数，保留isdelete=false的数据</span><br><span class="line">                def get_queryset(self):</span><br><span class="line">                    return super(StudentManager, self).get_queryset().\</span><br><span class="line">                        filter(isdelete= False)</span><br><span class="line"></span><br><span class="line">                def createStudent(self, sname, sage, sgender, sbirth, sgrade, isdelete=False):</span><br><span class="line">                    # 创建模型对象</span><br><span class="line">                    stu = self.model()</span><br><span class="line">                    stu.age = sage</span><br><span class="line">                    stu.name = sname</span><br><span class="line">                    stu.birth = sbirth</span><br><span class="line">                    stu.gender = sgender</span><br><span class="line">                    stu.grade = sgrade</span><br><span class="line">                    stu.isdelete = isdelete</span><br><span class="line">                    stu.save()</span><br><span class="line"></span><br><span class="line">查询模型</span><br><span class="line">    功能：对数据库中的数据进行田间查询，查询器可以有多个过滤器</span><br><span class="line">    查询基函数方法：</span><br><span class="line">        all()</span><br><span class="line">                获取全部的数据集合对象</span><br><span class="line">        filter()</span><br><span class="line">                获取复合条件的数据集合</span><br><span class="line">                filter(键=值)</span><br><span class="line">                filter(键=值， 键=值)</span><br><span class="line">                filter(键=值).filter(键=值)</span><br><span class="line">        exclude()</span><br><span class="line">                过滤掉复合条件的数据集</span><br><span class="line">        order_by()</span><br><span class="line">                排序</span><br><span class="line">        values()</span><br><span class="line">                返回字典为元素的列表，每个字典包含一个对象数据</span><br><span class="line"></span><br><span class="line">    单个数据返回的函数：</span><br><span class="line">            get()   没找到数据或者找到多个数据都会发生异常</span><br><span class="line">            count() 返回查询集的对象个数</span><br><span class="line">            first() 返回查询集的第一个对象</span><br><span class="line">            last()  返回查询集的最后一个对象</span><br><span class="line">            exists() 返回布尔值，判断数据集中是否有数据对象</span><br><span class="line"></span><br><span class="line">    返回有限的数据集数据对象</span><br><span class="line">            由于数据集合是由列表展现在出来的，所以可以用角标提取[a:b],角标不可用负数。</span><br><span class="line"></span><br><span class="line">    查询集的缓存概念：每次的查询都会保留缓存，除了第一次为空，是为了提高查询的效率</span><br><span class="line"></span><br><span class="line">    逻辑查询字段</span><br><span class="line">        相当于filter，exclude，get等函数的参数</span><br><span class="line">        语法： 属性名__比较运算符=值   双下划线</span><br><span class="line">        外键： 属性名_id=值</span><br><span class="line">        转义： % _ 等特殊符号直接被转义为一般符号</span><br><span class="line"></span><br><span class="line">        比较运算符：</span><br><span class="line">            exact 判断 filter(isdelete=False)大小写敏感</span><br><span class="line">            contains 包含 students.stuobj2.fliter(name__contain=&#x27;sun&#x27;)</span><br><span class="line">            startswith和endswith  以什么卡头或结尾  students.stuobj2.fliter(name__startswith=&#x27;sun&#x27;)</span><br><span class="line">            前面加上i就不存在大小写敏感  iexact， icontains，istartswith， iendswith</span><br><span class="line">            isnull isnotnull  是否为空 filter(name__isnull= False)</span><br><span class="line">            in 是否在指定的范围内 students.stuobj2.filter(pk__in= [2,4,6,8,10])</span><br><span class="line">            gt,gte,lt,lte 大于，大于等于，小于，小于等于</span><br><span class="line">            year,month,day,week_day,hour,minute,second时间上的判断</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        聚合函数</span><br><span class="line">            使用aggregate（）函数返回聚合函数的值</span><br><span class="line">            Max</span><br><span class="line">            Min</span><br><span class="line">            Sum</span><br><span class="line">            Avg</span><br><span class="line">            Count</span><br><span class="line"></span><br><span class="line">            from django.db.model import Max</span><br><span class="line">            # 返回最大的年龄数值</span><br><span class="line">            Students.stuobj2.aggregate(Max(&#x27;age&#x27;))</span><br><span class="line"></span><br><span class="line">        F对象    对象内部属性值的相互比较</span><br><span class="line">            from django.db.models import F,Q</span><br><span class="line">            #F对象的使用,模型内部的属性值间的比较，查询男生小于女生的班级</span><br><span class="line">            # stu = Grades.objects.filter(girlsnum__gt= F(&#x27;boysnum&#x27;))</span><br><span class="line">            # F对象的数学运算使用</span><br><span class="line">            stu = Grades.objects.filter(girlsnum__gte= F(&#x27;boysnum&#x27;) + 20)</span><br><span class="line"></span><br><span class="line">        Q对象    用于对象内部属性值间的或比较需求</span><br><span class="line">            #     选择班级为1和2的学生</span><br><span class="line">            stu = Students.stuobj2.filter(Q(grade= 1) | Q(grade= 2))</span><br><span class="line">            #     选择班级不为1的学生</span><br><span class="line">            stu = Students.stuobj2.filter(~Q(grade= 1))</span><br><span class="line">        跨关联查询</span><br><span class="line">            #      在班级表中查询学生名字有Lucy的班级</span><br><span class="line">            stu = Grades.objects.filter(students__name__contains= &#x27;lucy&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="部署asgi-daphne"><a href="#部署asgi-daphne" class="headerlink" title="部署asgi daphne"></a>部署asgi daphne</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">启动</span><br><span class="line">    sudo vim /etc/supervisor/conf.d/django.conf</span><br><span class="line">        [program:django]</span><br><span class="line">        user=android</span><br><span class="line">        directory=/home/android/service/WebSCM</span><br><span class="line">        command=bash -c &quot;/usr/local/python3.8.5/bin/daphne -b 127.0.0.1 -p 8080 core.asgi:application&quot;</span><br><span class="line">        autostart=true</span><br><span class="line">        autorestart=true</span><br><span class="line">        redirect_stderr=true</span><br><span class="line">        stdout_logfile=/home/android/service/WebSCM/django.output</span><br><span class="line"></span><br><span class="line">        [program:celery_worker_default]</span><br><span class="line">        user=android</span><br><span class="line">        directory=/home/android/service/WebSCM</span><br><span class="line">        command=bash -c &quot;/usr/local/python3.8.5/bin/celery -A core worker -l info -Q default -c 10&quot;</span><br><span class="line">        autostart=true</span><br><span class="line">        autorestart=true</span><br><span class="line">        redirect_stderr=true</span><br><span class="line">        stdout_logfile=/home/android/service/WebSCM/celery.worker.default.output</span><br><span class="line"></span><br><span class="line">        [program:celery_worker_jenkins]</span><br><span class="line">        user=android</span><br><span class="line">        directory=/home/android/service/WebSCM</span><br><span class="line">        command=bash -c &quot;/usr/local/python3.8.5/bin/celery -A core worker -l info -Q jenkins_queue -c 1&quot;</span><br><span class="line">        autostart=true</span><br><span class="line">        autorestart=true</span><br><span class="line">        redirect_stderr=true</span><br><span class="line">        stdout_logfile=/home/android/service/WebSCM/celery.worker.jenkins.output</span><br><span class="line"></span><br><span class="line">        [program:celery_beat]</span><br><span class="line">        user=android</span><br><span class="line">        directory=/home/android/service/WebSCM</span><br><span class="line">        command=bash -c &quot;/usr/local/python3.8.5/bin/celery -A core beat -l info&quot;</span><br><span class="line">        autostart=true</span><br><span class="line">        autorestart=true</span><br><span class="line">        redirect_stderr=true</span><br><span class="line">        stdout_logfile=/home/android/service/WebSCM/celery.beat.output</span><br><span class="line"></span><br><span class="line">    sudo service supervisor restart（重启）</span><br><span class="line">    sudo service supervisor status（查看状态）</span><br><span class="line"></span><br><span class="line">nginx配置</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        listen [::]:80;</span><br><span class="line"></span><br><span class="line">        server_name web_scm_service;</span><br><span class="line"></span><br><span class="line">        client_max_body_size     50m;</span><br><span class="line">        client_header_timeout    1m;</span><br><span class="line">        client_body_timeout      1m;</span><br><span class="line">        proxy_connect_timeout     60s;</span><br><span class="line">        proxy_read_timeout      1m;</span><br><span class="line">        proxy_send_timeout      1m;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">           try_files $uri @proxy_to_app;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location @proxy_to_app &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8080;</span><br><span class="line"></span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line">            proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">            proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line"></span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Forwarded-Host $server_name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /static &#123;</span><br><span class="line">            alias /home/android/service/WebSCM/static;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h2 id="部署uwsgi"><a href="#部署uwsgi" class="headerlink" title="部署uwsgi"></a>部署uwsgi</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">安装uwsgi</span><br><span class="line">    sudo pip3 install uwsgi</span><br><span class="line"></span><br><span class="line">安装nginx</span><br><span class="line">    sudo apt install nginx</span><br><span class="line"></span><br><span class="line">uwsgi配置文件</span><br><span class="line">    [uwsgi]</span><br><span class="line">    #套接字方式--使用nginx连接时使用,后面是Django程序所在服务器地址</span><br><span class="line">    # socket=192.168.0.214:8000</span><br><span class="line"></span><br><span class="line">    #http通信方式--直接做web服务器使用,后面是Django程序所在服务器地址</span><br><span class="line">    socket=127.0.0.1:8091</span><br><span class="line"></span><br><span class="line">    #配置当前工作的项目目录</span><br><span class="line">    chdir=/data/web/WebGame</span><br><span class="line"></span><br><span class="line">    #项目中wsgi.py文件的目录，相对于项目目录</span><br><span class="line">    wsgi-file=core/wsgi.py</span><br><span class="line"></span><br><span class="line">    # 进程数</span><br><span class="line">    processes=2</span><br><span class="line"></span><br><span class="line">    # 线程数</span><br><span class="line">    threads=2</span><br><span class="line"></span><br><span class="line">    # 开启主进程模式--uwsgi服务器的角色   uwsgi做主进程,关闭该进程其他相关进程也会被杀掉</span><br><span class="line">    master=True</span><br><span class="line"></span><br><span class="line">    # 存放进程编号的文件</span><br><span class="line">    pidfile=uwsgi.pid</span><br><span class="line"></span><br><span class="line">    # 后台运行,并输出日志，后面是日志文件位置，后台运行时看不见终端所以只能查看日志</span><br><span class="line">    daemonize=uwsgi.log</span><br><span class="line"></span><br><span class="line">uwsgi启动和停止</span><br><span class="line">    启动：uwsgi --ini uwsgi.ini</span><br><span class="line">    停止：uwsgi --stop uwsgi.pid</span><br><span class="line">    重启：uwsgi --reload xxx.pid</span><br><span class="line"></span><br><span class="line">nginx配置代理</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 8081;</span><br><span class="line"></span><br><span class="line">        listen [::]:8081;</span><br><span class="line"></span><br><span class="line">        server_name web_game_service;</span><br><span class="line"></span><br><span class="line">        client_max_body_size     50m;</span><br><span class="line">        client_header_timeout    1m;</span><br><span class="line">        client_body_timeout      1m;</span><br><span class="line">        proxy_connect_timeout     60s;</span><br><span class="line">        proxy_read_timeout      1m;</span><br><span class="line">        proxy_send_timeout      1m;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            include  uwsgi_params;</span><br><span class="line">            uwsgi_pass  127.0.0.1:8091;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /static &#123;</span><br><span class="line">            alias /data/web/WebGame/static;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，表有两种引擎，一种是InnoDB，另外一种是myisam。如果使用的是InnoDB引擎，是支持外键约束的。外键的存在使得ORM框架在处理表关系的时候异常的强大。MySQL数据库默认使用的也是InnoDB引擎。</span><br><span class="line"></span><br><span class="line">使用外键</span><br><span class="line">新建一个项目，创建一个article的app，添加至settings中，并且在settings中设置数据库的连接，调至整个项目能运行为止。</span><br><span class="line"></span><br><span class="line">类定义为class ForeignKey(to,on_delete,**options)。第一个参数是引用的是哪个模型，第二个参数是在使用外键引用的模型数据被删除了，这个字段该如何处理，比如有CASCADE、SET_NULL等（外键删除各个参数的意思）。这里以一个实际案例来说明。比如有一个Category和一个Article两个模型。一个种类下可以包含多篇文章，一个Article只能有一个种类，并且通过外键进行引用。那么相关的示例代码如下：</span><br><span class="line"></span><br><span class="line">1. 在同一个app中使用外键</span><br><span class="line">在article中的models中写入代码：</span><br><span class="line"></span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># Create your models here.</span><br><span class="line">class Category(models.Model):</span><br><span class="line">    name = models.CharField(max_length=100)</span><br><span class="line"></span><br><span class="line">class Article(models.Model):</span><br><span class="line">    title = models.CharField(max_length=100)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    # 是由Category影响Article</span><br><span class="line">    category = models.ForeignKey(&#x27;Category&#x27;,on_delete=models.CASCADE)</span><br><span class="line">这里我们就在Article中设置了一个外键category。</span><br><span class="line"></span><br><span class="line">以上使用ForeignKey来定义模型之间的关系。即在article的实例中可以通过category属性来操作对应的Category模型。这样使用起来非常的方便。示例代码如下：views中写入</span><br><span class="line"></span><br><span class="line">from django.shortcuts import render</span><br><span class="line">from . import models</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">def index(request):</span><br><span class="line"></span><br><span class="line">    # 插入数据</span><br><span class="line">    # article = models.Article(title=&#x27;abc&#x27;,content=&#x27;111&#x27;)</span><br><span class="line">    # category = models.Category(name=&#x27;最新文章&#x27;)</span><br><span class="line">    # category.save()</span><br><span class="line">    # article.category = category</span><br><span class="line">    # article.save()</span><br><span class="line"></span><br><span class="line">    #读取数据</span><br><span class="line">    article = models.Article.objects.first()</span><br><span class="line">    print(article.category.name)</span><br><span class="line">    return HttpResponse(&#x27;successful&#x27;)</span><br><span class="line">在上面代码中把相应的注释去了，就能够进行测试了。</span><br><span class="line"></span><br><span class="line">为什么使用了ForeignKey后，就能通过category访问到对应的Catrgory对象呢。因此在底层，Django为Article表添加了一个属性名_id的字段（比如category的字段名称是category_id），这个字段是一个外键，记录着对应的种类的主键。以后通过article.category访问的时候，实际上是先通过category_id找到对应的数据，然后再提取Category表中的这条数据，形成一个模型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">外间删除操作的参数意思：</span><br><span class="line">如果一个模型使用了外键。那么在对方那个模型被删掉后，该进行什么样的操作。可以通过on_delete来指定。可以指定的类型如下：</span><br><span class="line"></span><br><span class="line">CASCADE：级联操作。如果外键对应的那条数据被删除了，那么这条数据也会被删除。</span><br><span class="line">PROTECT：受保护。即只要这条数据引用了外键的那条数据，那么就不能删除外键的那条数据。如果我们强行删除，Django就会报错。</span><br><span class="line">SET_NULL：设置为空。如果外键的那条数据被删除了，那么在本条数据上就将这个字段设置为空。如果设置这个选项，前提是要指定这个字段可以为空。</span><br><span class="line">SET_DEFAULT：设置默认值。如果外键的那条数据被删除了，那么本条数据上就将这个字段设置为默认值。如果设置这个选项，== 前提是要指定这个字段一个默认值 ==。</span><br><span class="line">SET()：如果外键的那条数据被删除了。那么将会获取SET函数中的值来作为这个外键的值。SET函数可以接收一个可以调用的对象（比如函数或者方法），如果是可以调用的对象，那么会将这个对象调用后的结果作为值返回回去。== 可以不用指定默认值 ==</span><br><span class="line">DO_NOTHING：不采取任何行为。一切全看数据库级别的约束。</span><br><span class="line">以上这些选项只是Django级别的，数据级别依旧是RESTRICT！</span><br><span class="line"></span><br><span class="line">数据库层面的约束有四种：</span><br><span class="line"></span><br><span class="line">RESTRICT：默认的选项，如果想要删除父表的记录时，而在子表中有关联该父表的记录，则不允许删除父表中的记录；</span><br><span class="line">NOACTION：同 RESTRICT效果一样，也是首先先检查外键;</span><br><span class="line">CASCADE：父表delete、update的时候，子表会delete、update掉关联记录；</span><br><span class="line">SET NULL:父表delete、update的时候，子表会将关联记录的外键字段所在列设为null，所以注意在设计子表时外键不能设为not null；</span><br><span class="line"></span><br><span class="line">注：</span><br><span class="line">    django外键主要是一对一的方案</span><br><span class="line">    主从表主要是一对多的方案</span><br></pre></td></tr></table></figure>

<h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全称 JSON web token</span><br><span class="line">先说说要后端要保存token或者session的做法是怎么样的：</span><br><span class="line">    首先是用户登录，当我们校验完用户身份后，我们在缓存里或者数据库里的登录表里写上用户的信息和过期时间，然后导出一个登录id给用户使用。</span><br><span class="line">    当用户再次访问时，带上这个登录id上来，你用这个id从登录表里查到用户信息进行校验，然后进行业务。</span><br><span class="line">    诶，那现在我不想维护一个登录表了，要怎么搞？</span><br><span class="line">    简单呀，直接把用户信息发给客户端，让客户端每次把用户信息都带过来，这样请求一进来，连表都不用查，直接就知道是哪个用户在请求。</span><br><span class="line"></span><br><span class="line">加个密呗，简单点的能自己解开就可以了。复杂点搞个私钥自己在服务器里面玩解密加密。</span><br><span class="line">这样，中间人老哥们拿到密文，一时半会也解不开，破解成本也高，大概率大大咧咧地走了。</span><br><span class="line">留下一小部分有备(KPI)而来的老哥还在苦苦地想方设法破解你的密文。</span><br><span class="line">这样你一解密，你就拿到用户信息了，同样的，你把过期时间也写进密文里面，遇到过期就401跳登录页。这样，一个不需要后端存储登录凭证的方案就出炉咯。</span><br></pre></td></tr></table></figure>

<h2 id="DRF"><a href="#DRF" class="headerlink" title="DRF"></a>DRF</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">教程</span><br><span class="line">    https://blog.csdn.net/litaimin/article/details/122976825</span><br><span class="line">    https://blog.csdn.net/weixin_43924621/article/details/119305558</span><br><span class="line">安装</span><br><span class="line">    pip install djangorestframework</span><br><span class="line">配置</span><br><span class="line">    INSTALLED_APPS = [</span><br><span class="line">        ...</span><br><span class="line">        &#x27;rest_framework&#x27;,</span><br><span class="line">    ]</span><br><span class="line">添加路由</span><br><span class="line">    urlpatterns = [</span><br><span class="line">        ...</span><br><span class="line">        path(&#x27;api-auth/&#x27;, include(&#x27;rest_framework.urls&#x27;))</span><br><span class="line">    ]</span><br><span class="line">写view</span><br><span class="line">    from django.urls import path, include</span><br><span class="line">    from django.contrib.auth.models import User</span><br><span class="line">    from rest_framework import routers, serializers, viewsets</span><br><span class="line"></span><br><span class="line">    class UserSerializer(serializers.HyperlinkedModelSerializer):</span><br><span class="line">        class Meta:</span><br><span class="line">            model = User</span><br><span class="line">            fields = [&#x27;url&#x27;, &#x27;username&#x27;, &#x27;email&#x27;, &#x27;is_staff&#x27;]</span><br><span class="line"></span><br><span class="line">    class UserViewSet(viewsets.ModelViewSet):</span><br><span class="line">        queryset = User.objects.all()</span><br><span class="line">        serializer_class = UserSerializer</span><br><span class="line"></span><br><span class="line">    router = routers.DefaultRouter()</span><br><span class="line">    router.register(r&#x27;users&#x27;, UserViewSet)</span><br><span class="line"></span><br><span class="line">    urlpatterns = [</span><br><span class="line">        path(&#x27;&#x27;, include(router.urls)),</span><br><span class="line">        path(&#x27;api-auth/&#x27;, include(&#x27;rest_framework.urls&#x27;, namespace=&#x27;rest_framework&#x27;))</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<h2 id="django-forms使用"><a href="#django-forms使用" class="headerlink" title="django forms使用"></a>django forms使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from django import forms</span><br><span class="line">class StudentForm(forms.Form):</span><br><span class="line">    name = forms.CharField(max_length=16, required=True, min_length=2,</span><br><span class="line">                           error_messages=&#123;&#x27;max_length&#x27;: &#x27;名字最长为16&#x27;,</span><br><span class="line">                                           &#x27;min_length&#x27;: &#x27;名字最短为2&#x27;,</span><br><span class="line">                                           &#x27;required&#x27;: &#x27;名字必填&#x27;&#125;)</span><br><span class="line">    age = forms.IntegerField(max_value=30, min_value=10,</span><br><span class="line">                             error_messages=&#123;&#x27;max_value&#x27;: &#x27;年龄最大为30&#x27;,</span><br><span class="line">                                             &#x27;min_value&#x27;: &#x27;年龄最小为10&#x27;&#125;)</span><br><span class="line">    gender = forms.BooleanField(required=False, error_messages=&#123;&#x27;required&#x27;: &#x27;性别必填&#x27;&#125;)</span><br><span class="line">    g = forms.ModelChoiceField(queryset=Grade.objects.all(), error_messages=&#123;&#x27;queryset&#x27;: &#x27;没有这个班级&#x27;&#125;)</span><br><span class="line">    c = forms.ModelMultipleChoiceField(queryset=Course.objects.all(), error_messages=&#123;&#x27;queryset&#x27;: &#x27;不存在这个课程&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">form = StudentForm(json.loads(request.body))</span><br><span class="line">if not form.is_valid():</span><br><span class="line">    return JsonResponse(&#123;&#x27;code&#x27;: 200, &#x27;msg&#x27;: form.errors&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="celery-redis-实现任务异步、消息队列"><a href="#celery-redis-实现任务异步、消息队列" class="headerlink" title="celery + redis 实现任务异步、消息队列"></a>celery + redis 实现任务异步、消息队列</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">安装库 celery</span><br><span class="line">    sudo pip3 install celery</span><br><span class="line">配置settings（settings.py同级）</span><br><span class="line">    # Broker配置，使用Redis作为消息中间件</span><br><span class="line">    CELERY_BROKER_URL = &quot;redis://:123456@192.168.33.60:6379/1&quot;</span><br><span class="line">    # BACKEND配置，这里使用redis</span><br><span class="line">    CELERY_RESULT_BACKEND = &quot;redis://:123456@192.168.33.60:6379/2&quot;</span><br><span class="line">    # 结果序列化方案</span><br><span class="line">    CELERY_RESULT_SERIALIZER = &#x27;json&#x27;</span><br><span class="line">    # 任务结果过期时间，秒</span><br><span class="line">    CELERY_TASK_RESULT_EXPIRES = 60 * 60 * 24</span><br><span class="line">    # 时区配置</span><br><span class="line">    CELERY_TIMEZONE = &#x27;Asia/Shanghai&#x27;</span><br><span class="line">    # 指定导入的任务模块，可以指定多个</span><br><span class="line">    # CELERY_IMPORTS = (</span><br><span class="line">    #    &#x27;other_dir.tasks&#x27;,</span><br><span class="line">    # )</span><br><span class="line">配置celery.py（settings.py同级）</span><br><span class="line">    from __future__ import absolute_import, unicode_literals</span><br><span class="line">    from celery import Celery</span><br><span class="line">    import os</span><br><span class="line">    # 配置默认的django settings模块配置给celery</span><br><span class="line">    os.environ.setdefault(&#x27;DJANGO_SETTINGS_MODULE&#x27;, &#x27;core.settings&#x27;)</span><br><span class="line">    app = Celery(&#x27;core&#x27;)</span><br><span class="line">    # 命名空间</span><br><span class="line">    namespace = &#x27;CELERY&#x27;</span><br><span class="line">    app.config_from_object(&#x27;django.conf:settings&#x27;, namespace=&#x27;CELERY&#x27;)</span><br><span class="line">    # 如果你把所有的task都定义在单独的tasks.py模块中，加上这句话celery会自动发现这些模块中的task，</span><br><span class="line">    app.autodiscover_tasks()</span><br><span class="line">配置__init__.py（settings.py同级）</span><br><span class="line">    from __future__ import absolute_import, unicode_literals</span><br><span class="line">    from .celery import app as celery_app</span><br><span class="line">    __all__ = [&#x27;celery_app&#x27;]</span><br><span class="line">配置tasks.py（settings.py同级）</span><br><span class="line">    from celery import shared_task</span><br><span class="line">    @shared_task</span><br><span class="line">    def do_task():</span><br><span class="line">        time.sleep(20)</span><br><span class="line">        return &quot;success&quot;</span><br><span class="line">调用</span><br><span class="line">    from .tasks import do_task</span><br><span class="line">    res = do_task.delay()</span><br><span class="line">    print(res.task_id)</span><br><span class="line">启动redis</span><br><span class="line">    sudo pop3 install gevent</span><br><span class="line">    celery -A core worker -l info -P gevent</span><br><span class="line">    celery -A core beat -l info</span><br></pre></td></tr></table></figure>

<h2 id="django-vue-admin"><a href="#django-vue-admin" class="headerlink" title="django-vue-admin"></a>django-vue-admin</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">地址</span><br><span class="line">    https://django-vue-admin.com/</span><br><span class="line">    https://d2-crud-plus.docmirror.cn/d2-crud-plus/d2-crud-x/（d2-curd-x）</span><br><span class="line">    https://d2-crud-plus.docmirror.cn/d2-crud-plus/guide/（d2-crud-plus）</span><br><span class="line">    https://d2.pub/zh/doc/d2-admin/（d2-admin）</span><br><span class="line"></span><br><span class="line">环境</span><br><span class="line">    Python &gt;= 3.8.0 (推荐3.9+版本)</span><br><span class="line">    nodejs &gt;= 14.0 (推荐最新)</span><br><span class="line">    Mysql &gt;= 5.7.0 (可选，默认数据库sqlite3，推荐8.0版本)</span><br><span class="line">    Redis(可选，最新版)</span><br><span class="line"></span><br><span class="line">后端运行</span><br><span class="line">    进入后端项目目录:cd backend</span><br><span class="line">    在项目根目录中，复制 ./conf/env.example.py 文件为一份新的到 ./conf/env.py 下，并重命名为env.py</span><br><span class="line">    在 env.py 中配置数据库信息(默认数据库为sqlite3，测试演示可忽略此步骤)</span><br><span class="line">    安装依赖环境: pip install -r requirements.txt</span><br><span class="line">    执行迁移命令: python manage.py makemigrations; python manage.py migrate</span><br><span class="line">    初始化数据: python manage.py init</span><br><span class="line">    初始化省市县数据: python manage.py init_area</span><br><span class="line">    启动项目: python manage.py runserver 0.0.0.0:8000</span><br><span class="line"></span><br><span class="line">前端运行</span><br><span class="line">    进入前端项目目录 cd web</span><br><span class="line">    安装依赖 npm install --registry=https://registry.npm.taobao.org</span><br><span class="line">    启动服务 npm run dev</span><br><span class="line"></span><br><span class="line">访问项目</span><br><span class="line">    访问地址：http://localhost:8080 (opens new window)(默认为此地址，如有修改请按照配置文件)</span><br><span class="line">    账号：superadmin 密码：admin123456</span><br></pre></td></tr></table></figure></div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>