<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;p&gt;flask基础&lt;/p&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>flask基础 | Mijm Blog</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 6.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2022-06-30</div></div></div><div class="container post-header"><h1>flask基础</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">文档：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python-%E7%89%88%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">Python 版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-number">3.</span> <span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E4%BE%9D%E8%B5%96"><span class="toc-number">4.</span> <span class="toc-text">可选依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">5.</span> <span class="toc-text">虚拟环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Flask"><span class="toc-number">6.</span> <span class="toc-text">安装 Flask</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%AF%B4%E6%98%8E"><span class="toc-number">7.</span> <span class="toc-text">开发说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%83%AD%E9%83%A8%E7%BD%B2%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">支持热部署：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%BD%AC%E4%B9%89%EF%BC%8C%E9%98%B2%E6%AD%A2%E6%B3%A8%E5%85%A5%E5%A6%82%EF%BC%9A-lt-script-gt-alert-quot-bad-quot-lt-script-gt"><span class="toc-number">7.2.</span> <span class="toc-text">手动转义，防止注入如：&lt;script&gt;alert(&quot;bad&quot;)&lt;&#x2F;script&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%97url%E5%8F%82%E6%95%B0%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.3.</span> <span class="toc-text">接受url参数和类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url-for%E4%BD%9C%E7%94%A8"><span class="toc-number">7.4.</span> <span class="toc-text">url_for作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get%E5%92%8Cpost%E5%A4%84%E7%90%86"><span class="toc-number">7.5.</span> <span class="toc-text">get和post处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">7.6.</span> <span class="toc-text">Jinja2模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">7.7.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.8.</span> <span class="toc-text">请求对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">7.9.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookies"><span class="toc-number">7.10.</span> <span class="toc-text">cookies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session"><span class="toc-number">7.11.</span> <span class="toc-text">session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E9%94%99%E8%AF%AF"><span class="toc-number">7.12.</span> <span class="toc-text">重定向和错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E9%94%99%E8%AF%AF-1"><span class="toc-number">7.13.</span> <span class="toc-text">重定向和错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json%E6%A0%BC%E5%BC%8F%E7%9B%B8%E5%BA%94"><span class="toc-number">7.14.</span> <span class="toc-text">json格式相应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%97%AA%E7%8E%B0"><span class="toc-number">7.15.</span> <span class="toc-text">消息闪现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86"><span class="toc-number">7.16.</span> <span class="toc-text">日志处理</span></a></li></ol></li></ol></details></div><div class="container post-content"><p>flask基础</p>
<span id="more"></span>

<h2 id="文档："><a href="#文档：" class="headerlink" title="文档："></a>文档：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">w3c教程：https://www.w3cschool.cn/flask/flask_static_files.html</span><br><span class="line">Jinja2语法：https://zhuanlan.zhihu.com/p/462352820</span><br><span class="line"></span><br><span class="line">首页：https://dormousehole.readthedocs.io/en/latest/</span><br><span class="line">文档：https://dormousehole.readthedocs.io/en/latest/installation.html</span><br><span class="line">快速上手：https://dormousehole.readthedocs.io/en/latest/quickstart.html</span><br><span class="line">教程：https://dormousehole.readthedocs.io/en/latest/tutorial/index.html</span><br><span class="line">方案：https://dormousehole.readthedocs.io/en/latest/patterns/index.html</span><br><span class="line">API：https://dormousehole.readthedocs.io/en/latest/api.html</span><br><span class="line">部署方式：https://dormousehole.readthedocs.io/en/latest/deploying/index.html</span><br><span class="line">部署：https://dormousehole.readthedocs.io/en/latest/tutorial/deploy.html#</span><br></pre></td></tr></table></figure>

<h2 id="Python-版本"><a href="#Python-版本" class="headerlink" title="Python 版本"></a>Python 版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们推荐使用最新版本的 Python 。 Flask 支持 Python 3.6 以上版本。</span><br><span class="line">如果要支持 async ，那么因为会用到 contextvars.ContextVar ，所以需要 Python 3.7 以上版本。</span><br></pre></td></tr></table></figure>

<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当安装 Flask 时，以下配套软件会被自动安装。</span><br><span class="line">Werkzeug 用于实现 WSGI ，应用和服务之间的标准 Python 接口。</span><br><span class="line">Jinja 用于渲染页面的模板语言。</span><br><span class="line">MarkupSafe 与 Jinja 共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</span><br><span class="line">ItsDangerous 保证数据完整性的安全标志数据，用于保护 Flask 的 session cookie.</span><br><span class="line">Click 是一个命令行应用的框架。用于提供 flask 命令，并允许添加自定义 管理命令。</span><br></pre></td></tr></table></figure>

<h2 id="可选依赖"><a href="#可选依赖" class="headerlink" title="可选依赖"></a>可选依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">以下配套软件不会被自动安装。如果安装了，那么 Flask 会检测到这些软件。</span><br><span class="line">Blinker 为 信号 提供支持。</span><br><span class="line">python-dotenv 当运行 flask 命令时为 通过 dotenv 设置环境变量 提供支持。</span><br><span class="line">Watchdog 为开发服务器提供快速高效的重载。</span><br></pre></td></tr></table></figure>

<h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。</span><br><span class="line">为什么要使用虚拟环境？随着你的 Python 项目越来越多，你会发现不同的项目 会需要不同的版本的 Python 库。同一个 Python 库的不同版本可能不兼容。</span><br><span class="line">虚拟环境可以为每一个项目安装独立的 Python 库，这样就可以隔离不同项目之 间的 Python 库，也可以隔离项目与操作系统之间的 Python 库。</span><br><span class="line">Python 内置了用于创建虚拟环境的 venv 模块。</span><br></pre></td></tr></table></figure>

<h2 id="安装-Flask"><a href="#安装-Flask" class="headerlink" title="安装 Flask"></a>安装 Flask</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask</span><br></pre></td></tr></table></figure>









<h2 id="开发说明"><a href="#开发说明" class="headerlink" title="开发说明"></a>开发说明</h2><h3 id="支持热部署："><a href="#支持热部署：" class="headerlink" title="支持热部署："></a>支持热部署：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果您打开调试模式，那么服务 器会在修改应用代码之后自动重启</span><br></pre></td></tr></table></figure>

<h3 id="手动转义，防止注入如：-lt-script-gt-alert-quot-bad-quot-lt-script-gt"><a href="#手动转义，防止注入如：-lt-script-gt-alert-quot-bad-quot-lt-script-gt" class="headerlink" title="手动转义，防止注入如：&lt;script&gt;alert(&quot;bad&quot;)&lt;/script&gt;"></a>手动转义，防止注入如：<code>&lt;script&gt;alert(&quot;bad&quot;)&lt;/script&gt;</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&quot;/&lt;name&gt;&quot;)</span><br><span class="line">def hello(name):</span><br><span class="line">    return f&quot;Hello, &#123;escape(name)&#125;!&quot;</span><br></pre></td></tr></table></figure>

<h3 id="接受url参数和类型转换"><a href="#接受url参数和类型转换" class="headerlink" title="接受url参数和类型转换"></a>接受url参数和类型转换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/user/&lt;username&gt;&#x27;)</span><br><span class="line">def show_user_profile(username):</span><br><span class="line">    # show the user profile for that user</span><br><span class="line">    return f&#x27;User &#123;escape(username)&#125;&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/post/&lt;int:post_id&gt;&#x27;)</span><br><span class="line">def show_post(post_id):</span><br><span class="line">    # show the post with the given id, the id is an integer</span><br><span class="line">    return f&#x27;Post &#123;post_id&#125;&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/path/&lt;path:subpath&gt;&#x27;)</span><br><span class="line">def show_subpath(subpath):</span><br><span class="line">    # show the subpath after /path/</span><br><span class="line">    return f&#x27;Subpath &#123;escape(subpath)&#125;&#x27;</span><br><span class="line"></span><br><span class="line">类型</span><br><span class="line">    string （缺省值） 接受任何不包含斜杠的文本</span><br><span class="line">    int 接受正整数</span><br><span class="line">    float 接受正浮点数</span><br><span class="line">    path 类似 string ，但可以包含斜杠</span><br><span class="line">    uuid 接受 UUID 字符串</span><br></pre></td></tr></table></figure>

<h3 id="url-for作用"><a href="#url-for作用" class="headerlink" title="url_for作用"></a>url_for作用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">转义路径</span><br></pre></td></tr></table></figure>

<h3 id="get和post处理"><a href="#get和post处理" class="headerlink" title="get和post处理"></a>get和post处理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        return do_the_login()</span><br><span class="line">    else:</span><br><span class="line">        return show_the_login_form()</span><br></pre></td></tr></table></figure>

<h3 id="Jinja2模板引擎"><a href="#Jinja2模板引擎" class="headerlink" title="Jinja2模板引擎"></a>Jinja2模板引擎</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">from flask import render_template</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/hello/&#x27;)</span><br><span class="line">@app.route(&#x27;/hello/&lt;name&gt;&#x27;)</span><br><span class="line">def hello(name=None):</span><br><span class="line">    return render_template(&#x27;hello.html&#x27;, name=name)</span><br><span class="line"></span><br><span class="line">&#123;% ... %&#125; 语法</span><br><span class="line">&#123;&#123; ... &#125;&#125; 打印输出</span><br><span class="line">&#123;# ... #&#125; 注释</span><br><span class="line"># ... ## for Line Statements</span><br><span class="line"></span><br><span class="line">判断</span><br><span class="line">    &#123;% if username == &quot;xxY&quot; %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; username &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        &lt;p&gt;当前的用户名不是xxY&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">遍历</span><br><span class="line">    &#123;% for item in data_ %&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; item[0] &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; item[1] &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% for key,value in users.items() %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">包含</span><br><span class="line">    &#123;% include &#x27;HTML/samepart/header.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置局部变量</span><br><span class="line">    &#123;% with dict=&#123;&#x27;name&#x27;: &#x27;Sleet&#x27;, &#x27;sex&#x27;: &#x27;male&#x27;&#125; %&#125;</span><br><span class="line">        &#123;% for key in dict.keys() %&#125;</span><br><span class="line">            &lt;p&gt;&#123;&#123; dict[key] &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% with lst = [1,2,3] %&#125;</span><br><span class="line">        &#123;% for i in lst %&#125;</span><br><span class="line">            &lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line"></span><br><span class="line">with app.test_request_context(&#x27;/hello&#x27;, method=&#x27;POST&#x27;):</span><br><span class="line">    # now you can do something with the request until the</span><br><span class="line">    # end of the with block, such as basic assertions:</span><br><span class="line">    assert request.path == &#x27;/hello&#x27;</span><br><span class="line">    assert request.method == &#x27;POST&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="请求对象"><a href="#请求对象" class="headerlink" title="请求对象"></a>请求对象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/login&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span><br><span class="line">def login():</span><br><span class="line">    error = None</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        if valid_login(request.form[&#x27;username&#x27;],</span><br><span class="line">                       request.form[&#x27;password&#x27;]):</span><br><span class="line">            return log_the_user_in(request.form[&#x27;username&#x27;])</span><br><span class="line">        else:</span><br><span class="line">            error = &#x27;Invalid username/password&#x27;</span><br><span class="line">    # the code below is executed if the request method</span><br><span class="line">    # was GET or the credentials were invalid</span><br><span class="line">    return render_template(&#x27;login.html&#x27;, error=error)</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/upload&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        f = request.files[&#x27;the_file&#x27;]</span><br><span class="line">        f.save(&#x27;/var/www/uploads/uploaded_file.txt&#x27;)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">from werkzeug.utils import secure_filename</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/upload&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        file = request.files[&#x27;the_file&#x27;]</span><br><span class="line">        file.save(f&quot;/var/www/uploads/&#123;secure_filename(file.filename)&#125;&quot;)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h3 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    username = request.cookies.get(&#x27;username&#x27;)</span><br><span class="line">    # use cookies.get(key) instead of cookies[key] to not get a</span><br><span class="line">    # KeyError if the cookie is missing.</span><br><span class="line">储存 cookies:</span><br><span class="line"></span><br><span class="line">from flask import make_response</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    resp = make_response(render_template(...))</span><br><span class="line">    resp.set_cookie(&#x27;username&#x27;, &#x27;the username&#x27;)</span><br><span class="line">    return resp</span><br></pre></td></tr></table></figure>

<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">除了请求对象之外还有一种称为 session 的对象，允许您在不同请求 之间储存信息。这个对象相当于用密钥签名加密的 cookie ，</span><br><span class="line">即用户可以查看您的 cookie ，但是如果没有密钥就无法修改它。</span><br><span class="line"></span><br><span class="line">使用会话之前您必须设置一个密钥。举例说明:</span><br><span class="line"></span><br><span class="line">from flask import session</span><br><span class="line"></span><br><span class="line"># Set the secret key to some random bytes. Keep this really secret!</span><br><span class="line">app.secret_key = b&#x27;_5#y2L&quot;F4Q8z\n\xec]/&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    if &#x27;username&#x27; in session:</span><br><span class="line">        return f&#x27;Logged in as &#123;session[&quot;username&quot;]&#125;&#x27;</span><br><span class="line">    return &#x27;You are not logged in&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        session[&#x27;username&#x27;] = request.form[&#x27;username&#x27;]</span><br><span class="line">        return redirect(url_for(&#x27;index&#x27;))</span><br><span class="line">    return &#x27;&#x27;&#x27;</span><br><span class="line">        &lt;form method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type=text name=username&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/logout&#x27;)</span><br><span class="line">def logout():</span><br><span class="line">    # remove the username from the session if it&#x27;s there</span><br><span class="line">    session.pop(&#x27;username&#x27;, None)</span><br><span class="line">    return redirect(url_for(&#x27;index&#x27;))</span><br></pre></td></tr></table></figure>

<h3 id="重定向和错误"><a href="#重定向和错误" class="headerlink" title="重定向和错误"></a>重定向和错误</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from flask import abort, redirect, url_for</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return redirect(url_for(&#x27;login&#x27;))</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;)</span><br><span class="line">def login():</span><br><span class="line">    abort(401)</span><br><span class="line">    this_is_never_executed()</span><br></pre></td></tr></table></figure>

<h3 id="重定向和错误-1"><a href="#重定向和错误-1" class="headerlink" title="重定向和错误"></a>重定向和错误</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from flask import abort, redirect, url_for</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return redirect(url_for(&#x27;login&#x27;))</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/login&#x27;)</span><br><span class="line">def login():</span><br><span class="line">    abort(401)</span><br><span class="line">    this_is_never_executed()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">缺省情况下每种出错代码都会对应显示一个黑白的出错页面。使用 errorhandler() 装饰器可以定制出错页面:</span><br><span class="line">@app.errorhandler(404)</span><br><span class="line">def page_not_found(error):</span><br><span class="line">    return render_template(&#x27;page_not_found.html&#x27;), 404</span><br><span class="line">注意 render_template() 后面的 404 ，这表示页面对就的出错 代码是 404 ，即页面不存在。缺省情况下 200 表示：一切正常。</span><br><span class="line"></span><br><span class="line">可以使用 make_response() 包裹返回表达式，获得响应对象，并对该对象 进行修改，然后再返回:</span><br><span class="line">@app.errorhandler(404)</span><br><span class="line">def not_found(error):</span><br><span class="line">    resp = make_response(render_template(&#x27;error.html&#x27;), 404)</span><br><span class="line">    resp.headers[&#x27;X-Something&#x27;] = &#x27;A value&#x27;</span><br><span class="line">    return resp</span><br></pre></td></tr></table></figure>

<h3 id="json格式相应"><a href="#json格式相应" class="headerlink" title="json格式相应"></a>json格式相应</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JSON 格式的响应是常见的，用 Flask 写这样的 API 是很容易上手的。如果从视图 返回一个 dict ，那么它会被转换为一个 JSON 响应。</span><br><span class="line">    @app.route(&quot;/me&quot;)</span><br><span class="line">    def me_api():</span><br><span class="line">        user = get_current_user()</span><br><span class="line">        return &#123;</span><br><span class="line">            &quot;username&quot;: user.username,</span><br><span class="line">            &quot;theme&quot;: user.theme,</span><br><span class="line">            &quot;image&quot;: url_for(&quot;user_image&quot;, filename=user.image),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">如果 dict 还不能满足需求，还需要创建其他类型的 JSON 格式响应，可以使用 jsonify() 函数。该函数会序列化任何支持的 JSON 数据类型。 也可以研究研究 Flask 社区扩展，以支持更复杂的应用。</span><br><span class="line">    @app.route(&quot;/users&quot;)</span><br><span class="line">    def users_api():</span><br><span class="line">        users = get_all_users()</span><br><span class="line">        return jsonify([user.to_json() for user in users])</span><br></pre></td></tr></table></figure>

<h3 id="消息闪现"><a href="#消息闪现" class="headerlink" title="消息闪现"></a>消息闪现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_flashed_messages()</span><br></pre></td></tr></table></figure>

<h3 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.logger.debug(&#x27;A value for debugging&#x27;)</span><br><span class="line">app.logger.warning(&#x27;A warning occurred (%d apples)&#x27;, 42)</span><br><span class="line">app.logger.error(&#x27;An error occurred&#x27;)</span><br></pre></td></tr></table></figure></div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>