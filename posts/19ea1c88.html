<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;p&gt;git-lfs&lt;/p&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>git-lfs | Mijm Blog</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 6.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Git/" rel="tag">Git</a></div><div class="post-time">2022-06-30</div></div></div><div class="container post-header"><h1>git-lfs</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Github-%E5%AF%B9%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">Github 对文件大小的限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-gif-lfs"><span class="toc-number">2.</span> <span class="toc-text">为什么需要 gif-lfs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%B8%8D%E9%9C%80%E8%A6%81%E7%94%A8-gif-lfs"><span class="toc-number">3.</span> <span class="toc-text">什么情况下不需要用 gif-lfs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git-lfs-%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">git-lfs 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%96%87%E4%BB%B6%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90"><span class="toc-number">5.</span> <span class="toc-text">引用文件长什么样子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-git-lfs"><span class="toc-number">6.</span> <span class="toc-text">开始使用 git-lfs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85-git-lfs-Mac-%E7%8E%AF%E5%A2%83%E4%B8%8B"><span class="toc-number">6.1.</span> <span class="toc-text">如何安装 git-lfs (Mac 环境下)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Case-1-%E4%BB%8E-0-%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-git-lfs"><span class="toc-number">6.2.</span> <span class="toc-text">Case 1. 从 0 开始配置使用 git-lfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Case-2-%E8%A6%81%E5%9C%A8%E5%B7%B2%E6%9C%89%E7%9A%84%E4%BB%93%E5%BA%93%E4%B8%8A%E7%94%A8-git-lfs-%E8%BF%BD%E8%B8%AA%E6%9F%90%E4%BA%9B%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.</span> <span class="toc-text">Case 2. 要在已有的仓库上用 git-lfs 追踪某些文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Case-3-%E4%B8%8D%E5%86%8D%E8%B7%9F%E8%B8%AA%E6%9F%90%E4%BA%9B%E6%96%87%E4%BB%B6"><span class="toc-number">6.4.</span> <span class="toc-text">Case 3. 不再跟踪某些文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.5.</span> <span class="toc-text">其他常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">7.</span> <span class="toc-text">参考</span></a></li></ol></details></div><div class="container post-content"><p>git-lfs</p>
<span id="more"></span>

<h2 id="Github-对文件大小的限制"><a href="#Github-对文件大小的限制" class="headerlink" title="Github 对文件大小的限制"></a>Github 对文件大小的限制</h2><p>如果你在命令行用 <code>git push &gt; 50 MB</code> 的文件，你会收到一个 <code>warning</code>，但是你仍然可以正常 <code>push</code>，但是 <code>&gt; 100 MB</code> 的时候就无法 push 了</p>
<p>如果你在浏览器要上传文件的话，限制更为严重，不能超过 25 MB</p>
<p>另外有几点值得注意：</p>
<p>Github 建议仓库的大小理想情况下不要超过 1 GB，最好不要超过 5 GB<br>Github 从来不建议把仓库当成一种备份工具</p>
<h2 id="为什么需要-gif-lfs"><a href="#为什么需要-gif-lfs" class="headerlink" title="为什么需要 gif-lfs"></a>为什么需要 gif-lfs</h2><p>前面提到的 Github 对文件大小的限制是一点</p>
<p>另外因为每次我们在使用 <code>git commit</code> 的时候，其实是给当前的仓库创建了一次快照，本质是全仓库的克隆，如果大文件太多是很不好的，你的 Git 仓库会越来越大</p>
<h2 id="什么情况下不需要用-gif-lfs"><a href="#什么情况下不需要用-gif-lfs" class="headerlink" title="什么情况下不需要用 gif-lfs"></a>什么情况下不需要用 gif-lfs</h2><p>文件没有超过限制当然就没有必要用了<br>如果是要分发二进制文件（比如 *.exe）等，此时直接用 Github 提供的 release 功能就好了</p>
<h2 id="git-lfs-原理"><a href="#git-lfs-原理" class="headerlink" title="git-lfs 原理"></a>git-lfs 原理</h2><p>使用 <code>gif-lfs</code> 之后，在仓库中存储的其实是对大文件的引用，可以理解为指针。而真正的大文件托管在 Git Lfs 的服务器上</p>
<p>Github 给不同用户的 <code>git-lfs</code> 提供的额度不一样，免费用户和 Pro 用户都是 2 GB</p>
<h2 id="引用文件长什么样子"><a href="#引用文件长什么样子" class="headerlink" title="引用文件长什么样子"></a>引用文件长什么样子</h2><p>比如官方文档里面提到的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version https://git-lfs.github.com/spec/v1</span><br><span class="line">oid sha256:4cac19622fc3ada9c0fdeadb33f88f367b541f38b89102a3f1261ac81fd5bcb5</span><br><span class="line">size 84977953</span><br></pre></td></tr></table></figure>
<p>其中 <code>version</code> 是你正在使用的 <code>git-lfs</code> 的版本，<code>oid</code> 是标志符（id），<code>size</code> 是文件的真实大小</p>
<h2 id="开始使用-git-lfs"><a href="#开始使用-git-lfs" class="headerlink" title="开始使用 git-lfs"></a>开始使用 git-lfs</h2><h3 id="如何安装-git-lfs-Mac-环境下"><a href="#如何安装-git-lfs-Mac-环境下" class="headerlink" title="如何安装 git-lfs (Mac 环境下)"></a>如何安装 git-lfs (Mac 环境下)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; brew install git-lfs</span><br><span class="line">&gt; git lfa install                 # 如果输出为 Git LFS initialized. 就是正常安装好了</span><br></pre></td></tr></table></figure>

<h3 id="Case-1-从-0-开始配置使用-git-lfs"><a href="#Case-1-从-0-开始配置使用-git-lfs" class="headerlink" title="Case 1. 从 0 开始配置使用 git-lfs"></a>Case 1. 从 0 开始配置使用 git-lfs</h3><p>我们要指定 <code>git-lfs</code> 会把哪些文件当作大文件，指定方式比如有：</p>
<p>指定文件后缀名——<code>git lfs track &quot;*.filetype&quot;</code></p>
<p>指定某个目录下的所有文件——<code>git lfs track &quot;directory/*&quot;</code></p>
<p>具体指定某个文件——<code>git lfs track &quot;path/to/file&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; mkdir &lt;repo&gt;</span><br><span class="line">&gt; cd &lt;repo&gt;</span><br><span class="line">&gt; git init</span><br><span class="line">&gt; git lfs track &quot;*.filetype&quot;         # 比如 *.zip</span><br><span class="line"> </span><br><span class="line"># 其实 git lfs track 会修改 .gitattributes 文件的内容，可以做一个快速的验证</span><br><span class="line"># &gt; cat .gitattributes</span><br><span class="line"># *.zip filter=lfs diff=lfs merge=lfs -text</span><br><span class="line"> </span><br><span class="line"># 下面假定在 Github 有一个远程仓库供我们使用</span><br><span class="line"># 往仓库里加你先前指定的文件类型的大文件</span><br><span class="line">&gt; git add .                                         </span><br><span class="line">&gt; git commit -m &quot;&quot;</span><br><span class="line">&gt; git branch -M main</span><br><span class="line">&gt; git remote add origin git@github.com:&lt;username&gt;/&lt;remote_repo_name&gt;.git     # 这里替换为自己的用户名和远程仓库名</span><br><span class="line">&gt; git push -u origin main</span><br><span class="line"># 此时命令行会显示</span><br><span class="line"># &gt; uploading LFS objects</span><br><span class="line"># 如果没有采用 git-lfs，则显示如下内容</span><br><span class="line"># &gt; Enumerating objects: 3, done.</span><br><span class="line">#   Counting objects: 100% (3/3), done.</span><br><span class="line">#   Delta compression using up to 8 threads</span><br><span class="line">#   Compressing objects: 100% (2/2), done.</span><br></pre></td></tr></table></figure>

<h3 id="Case-2-要在已有的仓库上用-git-lfs-追踪某些文件"><a href="#Case-2-要在已有的仓库上用-git-lfs-追踪某些文件" class="headerlink" title="Case 2. 要在已有的仓库上用 git-lfs 追踪某些文件"></a>Case 2. 要在已有的仓库上用 git-lfs 追踪某些文件</h3><p>此时只是简单的使用 <code>git lfs track &quot;&quot;</code> 是没用的，因为你之前的 commit 已经生成了快照，你无法追踪历史中的这些大文件。</p>
<p><code>git-lfs</code> <strong>只会在你开始设置的此刻之后追踪新生成的指定文件</strong></p>
<p>可以快速做个验证，假设我们还在这个仓库里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; ls &gt; test1.txt</span><br><span class="line">&gt; ls -l &gt; test2.txt</span><br><span class="line">&gt; git add test1.txt test2.txt</span><br><span class="line">&gt; git commit -m &quot;Add txt files&quot;</span><br><span class="line"> </span><br><span class="line"># 假设我们现在要把 txt 文件当成是大文件，我们可能会想这么做</span><br><span class="line">&gt; git lfs track &quot;*.txt&quot;</span><br><span class="line">&gt; git add .gitattributes</span><br><span class="line">&gt; git commit -m &quot;Track *.txt files&quot;</span><br><span class="line">&gt; git lfs ls-files                      # 此时你会发现 git-lfs 并没有追踪 txt 文件</span><br><span class="line"> </span><br><span class="line">&gt; echo &quot;hello&quot; &gt; test3.txt</span><br><span class="line">&gt; git add test3.txt</span><br><span class="line">&gt; git commit -m &quot;Add test3.txt&quot;</span><br><span class="line">&gt; git lfs ls-files                      # 此时你可以在输出中看到 test3.txt</span><br></pre></td></tr></table></figure>

<p>正确的方法是使用 <code>git lfs migrate</code>，这里只列举了简单的用法，更复杂的可以看看手册。比如可以用 <code>--include-ref=</code> 指定分支，多个分支的时候最好一个分支一个分支地迁移，最后是 <code>git push --all -f</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; git lfs migrate import --include=&quot;*.txt&quot;  # 在当前分支上执行</span><br><span class="line">&gt; git lfs ls-files                          # 此时可以发现 text1.txt 和 text2.txt 也被追踪到了</span><br><span class="line">&gt; git push --force                          # 让远程仓库也改过来</span><br></pre></td></tr></table></figure>

<h3 id="Case-3-不再跟踪某些文件"><a href="#Case-3-不再跟踪某些文件" class="headerlink" title="Case 3. 不再跟踪某些文件"></a>Case 3. 不再跟踪某些文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; git lfs untrack &quot;*.filetype&quot;</span><br><span class="line">&gt; git rm --cached &quot;*.txt&quot;</span><br></pre></td></tr></table></figure>

<h3 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h3><p>查看当前 <code>git-lfs</code> 正在追踪的文件类型——<code>git lfs track</code><br>查看当前 <code>git-lfs</code> 正在追踪哪些文件——<code>git lfs ls-file</code></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github">https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github</a></p>
<p><a target="_blank" rel="noopener" href="http://www.zyiz.net/tech/detail-259950.html">http://www.zyiz.net/tech/detail-259950.html</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>