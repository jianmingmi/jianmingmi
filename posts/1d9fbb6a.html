<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;p&gt;Docker基础&lt;/p&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Docker基础 | Mijm Blog</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 6.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Docker/" rel="tag">Docker</a></div><div class="post-time">2023-03-15</div></div></div><div class="container post-header"><h1>Docker基础</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%AE%89%E8%A3%85%E5%92%8C%E5%90%AF%E5%8A%A8"><span class="toc-number">1.</span> <span class="toc-text">docker 安装和启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">docker 命令：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E3%80%81%E7%9B%AE%E5%BD%95%E3%80%81%E6%8F%90%E4%BA%A4%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">镜像、目录、提交及操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B6%E4%BD%9Cdocker-ubuntu%E9%95%9C%E5%83%8F"><span class="toc-number">4.</span> <span class="toc-text">制作docker ubuntu镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B6%E4%BD%9Cdocker%E7%BC%96%E8%AF%91%E9%95%9C%E5%83%8F"><span class="toc-number">5.</span> <span class="toc-text">制作docker编译镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">docker 集群搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E9%99%90%E5%88%B6%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">docker 限制资源使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F%E7%A7%81%E5%BA%93"><span class="toc-number">8.</span> <span class="toc-text">制作镜像私库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-compose%EF%BC%9A"><span class="toc-number">9.</span> <span class="toc-text">docker-compose：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-machine%EF%BC%88%E6%90%AD%E5%BB%BAdocker%E7%8E%AF%E5%A2%83%EF%BC%89%EF%BC%9A"><span class="toc-number">10.</span> <span class="toc-text">docker-machine（搭建docker环境）：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-swarm%EF%BC%88%E9%9B%86%E7%BE%A4%EF%BC%89%EF%BC%9A"><span class="toc-number">11.</span> <span class="toc-text">docker swarm（集群）：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E8%BE%89docker%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">群辉docker配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF"><span class="toc-number">13.</span> <span class="toc-text">docker可视化面板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Harbor"><span class="toc-number">14.</span> <span class="toc-text">Harbor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E6%95%99%E7%A8%8B%EF%BC%88k8s%EF%BC%89"><span class="toc-number">15.</span> <span class="toc-text">Kubernetes教程（k8s）</span></a></li></ol></details></div><div class="container post-content"><p>Docker基础</p>
<span id="more"></span>

<h2 id="docker-安装和启动"><a href="#docker-安装和启动" class="headerlink" title="docker 安装和启动"></a>docker 安装和启动</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dibian（docker.io是debian团队维护）</span><br><span class="line">    sudo apt install docker.io -y</span><br><span class="line">    sudo usermod -aG docker [user]</span><br><span class="line">    sudo service docker restart</span><br><span class="line">snap安装</span><br><span class="line">    sudo snap install docker</span><br><span class="line">    sudo snap start docker</span><br><span class="line">    注：通过snap安装的docker配置文件在：/var/snap/docker/471/config/daemon.json</span><br><span class="line">docker-ce（doker-ce是docker团队维护）</span><br><span class="line">    sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line">    curl -k -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">    sudo add-apt-repository &quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br><span class="line">    sudo apt update</span><br><span class="line">    sudo apt install docker-ce -y</span><br><span class="line">    sudo usermod -aG docker [user]</span><br><span class="line">    sudo service docker restart</span><br></pre></td></tr></table></figure>

<h2 id="docker-命令："><a href="#docker-命令：" class="headerlink" title="docker 命令："></a>docker 命令：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">docker info（查看docker目录，镜像站等）</span><br><span class="line">docker search [img]	搜索镜像</span><br><span class="line">docker images	列出镜像</span><br><span class="line">docker rmi [img]	删除镜像</span><br><span class="line">docker pull ubuntu:14.04	拉取14.04镜像</span><br><span class="line"></span><br><span class="line">docker stats 列出容器状态</span><br><span class="line">docker ps -a    列出所有容器</span><br><span class="line">docker stop my_sshd_ubuntu    停止容器</span><br><span class="line">docker rm my_sshd_ubuntu    删除容器</span><br><span class="line">docker start my_sshd_ubuntu    启动容器</span><br><span class="line">docker restart my_sshd_ubuntu    停止容器</span><br><span class="line">docker inspect my_sshd_ubuntu	查看容器信息</span><br><span class="line"></span><br><span class="line">docker run -d --restart always --name my_sshd_ubuntu ubuntu:14.04	运行容器(-d后台运行)</span><br><span class="line">docker cp my_docker_jenkins:/etc/localtime .	复制文件</span><br><span class="line">docker exec -it my_sshd_ubuntu bash    进入容器（exec运行命令，-it交互式运行）</span><br><span class="line">docker logs my_sshd_ubuntu  查看容器log</span><br><span class="line">docker save -o ubuntu_14.04.tgz ubuntu:14.04（镜像打包）</span><br><span class="line">docker load -i ubuntu_14.04.tgz（镜像导入）</span><br><span class="line">docker info（列出docker信息）</span><br><span class="line"></span><br><span class="line">docker network prune（清理不用的自定义网络）</span><br></pre></td></tr></table></figure>

<h2 id="镜像、目录、提交及操作"><a href="#镜像、目录、提交及操作" class="headerlink" title="镜像、目录、提交及操作"></a>镜像、目录、提交及操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">docker hub</span><br><span class="line">    https://hub.docker.com/r/library    jianmingmi</span><br><span class="line"></span><br><span class="line">提交镜像</span><br><span class="line">    docker login -u jianmingmi [192.168.33.86:8888]</span><br><span class="line">    docker commit my_mm_wiki jianmingmi/mm-wiki:0.2.1</span><br><span class="line">    docker tag jianmingmi/mm-wiki:0.2.1 jianmingmi/mm-wiki:latest</span><br><span class="line">    docker push jianmingmi/mm-wiki:0.2.1</span><br><span class="line">    docker push jianmingmi/mm-wiki:latest</span><br><span class="line"></span><br><span class="line">更新镜像源</span><br><span class="line">    sudo vim /etc/docker/daemon.json</span><br><span class="line">        &#123;</span><br><span class="line">        &quot;registry-mirrors&quot;: [&quot;http://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">    sudo systemctl daemon-reload; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">修改docker root dir位置</span><br><span class="line">    sudo vim /etc/docker/daemon.json</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;graph&quot;: &quot;/data/docker&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    sudo systemctl daemon-reload; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">修改docker ip段位置</span><br><span class="line">    sudo vim /etc/docker/daemon.json</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;default-address-pools&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;base&quot;: &quot;172.100.0.0/16&quot;,</span><br><span class="line">            &quot;size&quot;: 24</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    sudo systemctl daemon-reload; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">注：</span><br><span class="line">    container_name网络互通的情况下，可以当做ip</span><br><span class="line">    networks可以网络互通</span><br><span class="line">    depends_on用于启动时候，网络互通，并形成依赖关系</span><br><span class="line">    links用于启动后，网络互通</span><br></pre></td></tr></table></figure>

<h2 id="制作docker-ubuntu镜像"><a href="#制作docker-ubuntu镜像" class="headerlink" title="制作docker ubuntu镜像"></a>制作docker ubuntu镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line">    FROM ubuntu:16.04</span><br><span class="line">    MAINTAINER jmm</span><br><span class="line"></span><br><span class="line">    # 更新源、安装软件、创建</span><br><span class="line">    RUN apt-get update -y &amp;&amp; apt-get install -y openssh-server sudo &amp;&amp; mkdir -p /var/run/sshd &amp;&amp; echo &quot;LANG=C.UTF-8&quot; &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">    # 设置环境</span><br><span class="line">    RUN echo &quot;#!/bin/bash&quot; &gt; /start.sh &amp;&amp; echo &quot;/usr/sbin/sshd -D&quot; &gt;&gt; /start.sh &amp;&amp; chmod 755 /start.sh</span><br><span class="line"></span><br><span class="line">    # 创建用户</span><br><span class="line">    RUN useradd ubuntu -m -s /bin/bash &amp;&amp; echo &#x27;ubuntu:1qaz!QAZ&#x27; | chpasswd &amp;&amp; usermod -aG sudo ubuntu</span><br><span class="line"></span><br><span class="line">    # 如果有多个RUN，自上而下依次运行，每次运行都会形成新的层，建议&amp;&amp; 放入一行运行</span><br><span class="line">    # 如果有多个CMD，只有最后一个运行</span><br><span class="line">    # 如果有多个Entrypoint，只有最后一个运行</span><br><span class="line">    # 如果CMD和entrypoint共存，只有entrypoint运行，且最后的CMD会当做entrypoint的参数</span><br><span class="line">    ENTRYPOINT [&quot;/start.sh&quot;]</span><br><span class="line"></span><br><span class="line">编译</span><br><span class="line">    docker build -t jianmingmi/ubuntu:16.04 .</span><br><span class="line"></span><br><span class="line">docker-compose启动</span><br><span class="line">    vim docker-compose.yml</span><br><span class="line">    version: &quot;3&quot;</span><br><span class="line">    services:</span><br><span class="line">      my_ubuntu_18:</span><br><span class="line">        container_name: my_ubuntu_18</span><br><span class="line">        image: jianmingmi/ubuntu:18.04</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;10020:22&quot;</span><br><span class="line">        volumes:</span><br><span class="line">          - ./work:/work</span><br><span class="line">          - /etc/localtime:/etc/localtime:ro</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">    docker run -d --restart always \</span><br><span class="line">        --name my_ubuntu_18 \</span><br><span class="line">        -p 10020:22 \</span><br><span class="line">        -v /work/docker/my_ubuntu_18/work:/work \</span><br><span class="line">        -v /etc/localtime:/etc/localtime \</span><br><span class="line">        jianmingmi/ubuntu:18.04</span><br></pre></td></tr></table></figure>

<h2 id="制作docker编译镜像"><a href="#制作docker编译镜像" class="headerlink" title="制作docker编译镜像"></a>制作docker编译镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1.依赖jianmingmi/ubuntu镜像启动</span><br><span class="line">    vim docker-compose.yml</span><br><span class="line">    version: &quot;3&quot;</span><br><span class="line">    services:</span><br><span class="line">      my_ubuntu_18:</span><br><span class="line">        container_name: my_ubuntu_18</span><br><span class="line">        image: jianmingmi/ubuntu:18.04</span><br><span class="line">        restart: always</span><br><span class="line">2.修改/start.sh脚本</span><br><span class="line">    #!/bin/bash</span><br><span class="line">    if [ x&quot;$&#123;USER_NAME&#125;&quot; != x&quot;&quot; -a x&quot;$&#123;USER_PWD&#125;&quot; != x&quot;&quot; ];then</span><br><span class="line">      cur_user=$(cat /etc/passwd | grep $&#123;USER_NAME&#125;)</span><br><span class="line">      if [ x&quot;$&#123;cur_user&#125;&quot; == x&quot;&quot; ];then</span><br><span class="line">        useradd $&#123;USER_NAME&#125; -s /bin/bash -d /home/$&#123;USER_NAME&#125; &amp;&amp; echo &quot;$&#123;USER_NAME&#125;:$&#123;USER_PWD&#125;&quot; | chpasswd &amp;&amp; usermod -aG sudo $&#123;USER_NAME&#125;</span><br><span class="line">        cp /home/ubuntu/.bashrc /home/ubuntu/.profile /home/$&#123;USER_NAME&#125;</span><br><span class="line">        chmod 777 /home/$&#123;USER_NAME&#125;/.bashrc</span><br><span class="line">        chmod 777 /home/$&#123;USER_NAME&#125;/.profile</span><br><span class="line">      fi</span><br><span class="line">    fi</span><br><span class="line">    /usr/sbin/sshd -D</span><br><span class="line">3.替换源、安装软件、repo、libfile-copy-recursive-perl、rsync、python2（sudo apt install python-minimal）等</span><br><span class="line">4.镜像提交推送</span><br><span class="line">    docker login 192.168.33.86:8888</span><br><span class="line">    docker commit my_ubuntu_18 192.168.33.86:8888/library/ubuntu_tinno:18.04</span><br><span class="line">    docker push 192.168.33.86:8888/library/ubuntu_tinno:18.04</span><br><span class="line">5.配置registry-mirrors</span><br><span class="line">    sudo vim /etc/docker/daemon.json</span><br><span class="line">        &#123;</span><br><span class="line">        &quot;registry-mirrors&quot;: [&quot;http://192.168.33.86:8888&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">    sudo systemctl daemon-reload; sudo systemctl restart docker</span><br><span class="line">6.编写 docker-compose.yml</span><br><span class="line">    vim docker-compose.yml</span><br><span class="line">    version: &quot;3&quot;</span><br><span class="line">    services:</span><br><span class="line">      mijianming:</span><br><span class="line">        container_name: mijianming</span><br><span class="line">        image: 192.168.33.86:8888/library/ubuntu_tinno:18.04</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;10021:22&quot;</span><br><span class="line">        volumes:</span><br><span class="line">          - ./mijianming:/home/mijianming</span><br><span class="line">          - /etc/localtime:/etc/localtime:ro</span><br><span class="line">        environment:</span><br><span class="line">          - USER_NAME=mijianming</span><br><span class="line">          - USER_PWD=mijianming</span><br></pre></td></tr></table></figure>

<h2 id="docker-集群搭建"><a href="#docker-集群搭建" class="headerlink" title="docker 集群搭建"></a>docker 集群搭建</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  my_ubuntu_18_1:</span><br><span class="line">    container_name: my_ubuntu_18_1</span><br><span class="line">    image: jianmingmi/ubuntu:18.04</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;10031:22&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./work:/work</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">    networks:</span><br><span class="line">      jiqun:</span><br><span class="line"></span><br><span class="line">  my_ubuntu_18_2:</span><br><span class="line">    container_name: my_ubuntu_18_2</span><br><span class="line">    image: jianmingmi/ubuntu:18.04</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;10032:22&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./work:/work</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">    networks:</span><br><span class="line">      jiqun:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  jiqun:</span><br></pre></td></tr></table></figure>

<h2 id="docker-限制资源使用"><a href="#docker-限制资源使用" class="headerlink" title="docker 限制资源使用"></a>docker 限制资源使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  resources:</span><br><span class="line">     limits:</span><br><span class="line">        cpus: &quot;2.00&quot;</span><br><span class="line">        memory: 5G</span><br><span class="line">     reservations:</span><br><span class="line">        memory: 200M</span><br></pre></td></tr></table></figure>

<h2 id="制作镜像私库"><a href="#制作镜像私库" class="headerlink" title="制作镜像私库"></a>制作镜像私库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">启动</span><br><span class="line">    docker run -d --restart always -p 5000:5000 -v /home/android/service/registry/registry:/var/lib/registry --name private_registry registry</span><br><span class="line"></span><br><span class="line">修改配置</span><br><span class="line">    sudo vim /etc/docker/daemon.json</span><br><span class="line">        &#123;</span><br><span class="line">        &quot;insecure-registries&quot;:[&quot;192.168.33.60:5000&quot;]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">制作镜像并推送</span><br><span class="line">    docker pull hello-world</span><br><span class="line">    docker tag hello-world:latest 192.168.33.60:5000/hello-world</span><br><span class="line">    docker push 192.168.33.60:5000/hello-world</span><br><span class="line">    docker pull 192.168.33.60:5000/hello-world</span><br><span class="line"></span><br><span class="line">查看镜像</span><br><span class="line">    http://192.168.33.60:5000/v2/_catalog</span><br></pre></td></tr></table></figure>

<h2 id="docker-compose："><a href="#docker-compose：" class="headerlink" title="docker-compose："></a>docker-compose：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker-compose下载（已同步到gitee）：</span><br><span class="line">    curl -L &quot;https://gitee.com/jianmingmi/compose/releases/download/v1.29.2/docker-compose-Linux-x86_64&quot; -o docker-compose</span><br><span class="line">    curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-Linux-x86_64&quot; -o docker-compose</span><br><span class="line">docker-compose up -d：启动容器</span><br><span class="line">docker-compose restart：重启容器</span><br><span class="line">docker-compose down：移除容器</span><br></pre></td></tr></table></figure>

<h2 id="docker-machine（搭建docker环境）："><a href="#docker-machine（搭建docker环境）：" class="headerlink" title="docker-machine（搭建docker环境）："></a>docker-machine（搭建docker环境）：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">下载：sudo curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-`uname -s`-`uname -m` &gt;/usr/local/bin/docker-machine &amp;&amp; sudo chmod +x /usr/local/bin/docker-machine</span><br><span class="line">创建：docker-machine create -d generic --generic-ip-address=10.20.33.43 --generic-ssh-port=2222 --generic-ssh-key ~/.ssh/id_rsa --generic-ssh-user=jmm 10.20.33.43</span><br><span class="line">docker-machine ls（列出机器）</span><br><span class="line">docker-machine active（列出活动的机器）</span><br><span class="line">docker-machine inspect 10.20.33.43（列出详细）</span><br><span class="line">docker-machine ip 10.20.33.43（列出ip）</span><br><span class="line">docker-machine stop 10.20.33.43（停止）</span><br><span class="line">docker-machine rm 10.20.33.43（删除）</span><br><span class="line">docker-machine ssh 10.20.33.43（进入机器）</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">    privileged: true（设置容器的权限为root）</span><br></pre></td></tr></table></figure>

<h2 id="docker-swarm（集群）："><a href="#docker-swarm（集群）：" class="headerlink" title="docker swarm（集群）："></a>docker swarm（集群）：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 10.20.33.34</span><br><span class="line">docker swarm join --token [token] 10.20.33.34:2377</span><br><span class="line">docker network create -d overlay nginx_net</span><br><span class="line">docker network ls</span><br><span class="line">docker service create --replicas 1 --network nginx_net --name my_nginx -p 80:80 nginx</span><br><span class="line">docker service ls</span><br><span class="line">docker service inspect --pretty my_nginx</span><br><span class="line">docker service ps my_nginx</span><br><span class="line">docker service rm my_nginx</span><br><span class="line"></span><br><span class="line">docker swarm leave -f（离开集群）</span><br><span class="line">docker node ls</span><br><span class="line">docker node update --availability drain 10.20.33.43（修改节点状态，drain 下线，active 上线）</span><br></pre></td></tr></table></figure>

<h2 id="群辉docker配置文件"><a href="#群辉docker配置文件" class="headerlink" title="群辉docker配置文件"></a>群辉docker配置文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/packages/Docker/etc/dockerd.json</span><br></pre></td></tr></table></figure>

<h2 id="docker可视化面板"><a href="#docker可视化面板" class="headerlink" title="docker可视化面板"></a>docker可视化面板</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br><span class="line">    version: &quot;3&quot;</span><br><span class="line">    services:</span><br><span class="line">        my_portainer:</span><br><span class="line">            container_name: my_portainer</span><br><span class="line">            image: portainer/portainer</span><br><span class="line">            restart: always</span><br><span class="line">            ports:</span><br><span class="line">                - &quot;9000:9000&quot;</span><br><span class="line">            command:</span><br><span class="line">                -H unix:///var/run/docker.sock</span><br><span class="line">            volumes:</span><br><span class="line">                - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">                - ./data:/data</span><br></pre></td></tr></table></figure>

<h2 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">企业级 Registry 服务器</span><br><span class="line">https://github.com/jianmingmi/harbor</span><br><span class="line">安装</span><br><span class="line">    wget https://github.com/goharbor/harbor/releases/download/v2.6.3/harbor-offline-installer-v2.6.3.tgz</span><br><span class="line">    tar -zxvf harbor-offline-installer-v2.6.3.tgz</span><br><span class="line">    cp harbor.yml.tmpl harbor.yml</span><br><span class="line">    vim harbor.yml</span><br><span class="line">        修改hostname、port、harbor_admin_password</span><br><span class="line">        注释掉https</span><br><span class="line">    ./install.sh</span><br></pre></td></tr></table></figure>

<h2 id="Kubernetes教程（k8s）"><a href="#Kubernetes教程（k8s）" class="headerlink" title="Kubernetes教程（k8s）"></a>Kubernetes教程（k8s）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">k8s是一个开源的容器集群管理系统，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。</span><br><span class="line">    1、故障迁移：当某一个node节点关机或挂掉后，node节点上的服务会自动转移到另一个node节点上，这个过程所有服务不中断。这是docker或普通云主机是不能做到的</span><br><span class="line">    2、资源调度：当node节点上的cpu、内存不够用的时候，可以扩充node节点，新建的pod就会被kube-schedule调度到新扩充的node节点上</span><br><span class="line">    3、资源隔离：创建开发、运维、测试三个命名空间，切换上下文后，开发人员就只能看到开发命名空间的所有pod，看不到运维命名空间的pod，这样就不会造成影响，互不干扰</span><br><span class="line">         传统的主机或只有docker环境中，登录进去就会看到所有的服务或者容器</span><br><span class="line">    4、因为采用docker容器，进程之间互不影响，</span><br><span class="line">    5、安全：不同角色有不同的权限，查看pod、删除pod等操作；RBAC认证增加了k8s的安全</span><br><span class="line">        快速精准地部署应用程序</span><br><span class="line">            限制硬件用量仅为所需资源</span><br><span class="line">    Kubernetes 的优势</span><br><span class="line">        可移动: 公有云、私有云、混合云、多态云</span><br><span class="line">        可扩展: 模块化、插件化、可挂载、可组合</span><br><span class="line">        自修复: 自动部署、自动重启、自动复制、自动伸缩</span><br><span class="line"></span><br><span class="line">    负载均衡</span><br><span class="line">        k8s可以更快的更新新版本，打包应用，更新的时候可以做到不用中断服务，服务器故障不用停机，从开发环境到测试环境到生产环境的迁移极其方便，一个配置文件搞定，一次生成image，到处运行。。。</span><br><span class="line"></span><br><span class="line">1.关闭交换分区和防火墙和selinux</span><br><span class="line">    sudo vim /etc/fstab</span><br><span class="line">    systemctl stop ufw &amp;&amp; systemctl disable ufw</span><br><span class="line">2.安装docker</span><br><span class="line">    sudo apt install docker.io -y</span><br><span class="line">    sudo usermod -aG docker [user]</span><br><span class="line">    sudo service docker restart</span><br><span class="line">3.安装k8s</span><br><span class="line">    echo &quot;deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main&quot; &gt; /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">    apt update</span><br><span class="line">    sudo gpg --keyserver keyserver.ubuntu.com --recv FEEA9169307EA071</span><br><span class="line">    sudo gpg --export --armor FEEA9169307EA071 | sudo apt-key add -</span><br><span class="line">    sudo apt-get update</span><br><span class="line">    sudo apt-get install -y kubelet=1.16.3-00 kubectl=1.16.3-00 kubeadm=1.16.3-00</span><br><span class="line">4.初始化</span><br><span class="line">    kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version=v1.16.3 --pod-network-cidr=10.0.0.0/24</span><br><span class="line">    client加入命令需要复制</span><br><span class="line">5.初始化环境变量</span><br><span class="line">    mkdir -p $HOME/.kube</span><br><span class="line">    sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">    sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line">6.client部分</span><br><span class="line">    需要1、2、3部分</span><br><span class="line">    需要第四步的加入命令</span><br><span class="line">7.安装网络插件Flannel</span><br><span class="line">    https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line">    注：如果遇到The connection to the server raw.githubusercontent.com was refused - did you specify the right host or port?</span><br><span class="line">        查询真实ip：https://www.ipaddress.com，写到/etc/hosts中</span><br><span class="line">注：参考地址</span><br><span class="line">    https://zhuanlan.zhihu.com/p/97605697</span><br><span class="line">    https://www.cnblogs.com/fisherbook/p/14277388.html</span><br><span class="line">    https://blog.csdn.net/qq_43657581/article/details/97494505</span><br><span class="line"></span><br><span class="line">基本使用：</span><br><span class="line">    kubectl get nodes（查看所有的节点的状态）</span><br><span class="line">    kubectl get pod -n kube-system（查看所有节点上的组件容器）</span><br><span class="line">    kubectl get pod -n kube-system -o wide（查看更多信息）</span><br><span class="line">    kubectl describe pod kube-controller-manager-master -n kube-system（查看某个pod具体信息）</span><br><span class="line">    kubectl logs -f -n kube-system kube-controller-manager-master（查看某个pod日志）</span><br><span class="line"></span><br><span class="line">    kubectl create -f kubia-manual.yaml（创建一个pod）</span><br><span class="line">        apiVersion: v1</span><br><span class="line">        kind: Pod</span><br><span class="line">        metadata:</span><br><span class="line">          name: kubia-manual</span><br><span class="line">        spec:</span><br><span class="line">          containers:</span><br><span class="line">          - image: luksa/kubia</span><br><span class="line">            name: kubia</span><br><span class="line">            ports:</span><br><span class="line">            - containerPort: 8080</span><br><span class="line">              protocol: TCP</span><br><span class="line">    kubectl create namespace hello-world（创建命名空间）</span><br><span class="line">    kubectl explain pod（查看pod详细解释）</span><br><span class="line">    kubectl explain pod.matedata</span><br><span class="line">    kubectl delete pod kubia-4n2tg（删除pod）</span><br><span class="line">    kubectl get pod kubia-manual -o yaml（查看某个pod配置）</span><br><span class="line">    kubectl edit pod kubia-manual（编辑某个pod配置）Swarm</span><br></pre></td></tr></table></figure></div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcdn.net/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>