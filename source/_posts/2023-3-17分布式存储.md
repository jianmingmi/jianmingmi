---
uuid: 2ea106a0-bd7d-11ed-b001-4310c06203aa
title: 分布式存储
date: 2023-3-17
tags: [Linux]
---

分布式存储

<!--more-->

## DAS、SAN、NAS
1. DAS(Direct Attached Storage)---直连式存储，就是拿一根线把存储设备直接连接到PC机或服务器上，那比如u盘，是用的接口把自身的存储设备直接和PC相连接，DAS有一定的缺点，如果你电脑只有一个卡槽或者一个USB接口，那只能仅限于哪一个卡槽或者USB接口的存储量，也叫说扩展性差

2. SAN(Storage Area Network)---存储区域网络，它呢，是通过网络进行连接存储的，在DAS中只能通过一根线或者移动硬盘来连接存储设备，这有点不能满足人们的需求，于是SAN就通过网络来连接存储设备，这样存储目标就广泛了起来，(这种网络现在可以是以太网了--ip)
DAS,SAN都属于块存储(下面讲解)。

3. NAS(Network Attached Storage)—网络附加存储，就是NAS需要通过网络来进行访问，只要是有网络来连接这个存储设备就行，它属于文件存储

## 块存储、文件储存、对象存储
1. 块存储：首先DAS，SAN都属于块存储
块存储就是块设备----一切以磁盘的形式存在的存储就是块设备
a.块存储强调的是裸磁盘
b.所有以磁盘的形式直接提供给主机或服务器的设备都是块存储

2. 文件存储---基于网络的共享文件存储
补充：文件系统：用来管理存储设备，和存储设备里面的数据，在主机终端去访问数据时不是直接访问的数据而是通过文件系统来进行对数据的查询，搜索...之后返回给中终端的。文件夹中有一级一级的目录对吧，那就是文件系统的功劳，有了文件系统数据目录才会有层次的展现给用户。
文件存储就是在块存储的前面加上了一层文件系统，对外提供存储服务，说白了就是，“块设备+文件系统”打包就是文件存储。结合下图演示：

![](/images/2023-3-17分布式存储/1.png)

3. 块存储和文件储存的优缺点
块存储：优点：读写速度快，可扩展性差，不易于共享
文件存储：优点：易于共享，读写速度慢

4. 对象存储
对象存储就是一个全新的存储港式，它结合了块存储和文件存储的优点
特点：读写速度快，易于共享，扩展性强
对象存储和文件存储的文件系统完全不同，对象存储的文件系统时二层架构，文件存储用的传统的目录层结构的文件系统，就是在D盘建一个文件夹，在文件夹里面在建一个文件夹，然后在建文件夹等等，这就是目录结构的文件系统，那如果是这样，会降低存储的性能。

![](/images/2023-3-17分布式存储/2.png)


## 分布式存储的优势

1. 高可靠性：分布式存储有一个非常厉害的手段就是多时间点快照技术，可以让用户在一定的时间能够对各个版本数据进行备份，多时间点技术可以支持同时提取多个时间点的样本，并且能够在同一时间恢复数据。这项技术对于出现存储问题是非常有帮助的，并且避免存储问题产生的损失问题。多时间点快照为企业带来了非常可靠安心的数据安全保障。
2. 高扩展性：分布式存储会对集群服务器进行扩展，让系统的存储容量、计算和性能的能力都得到提高。而有些企业因为业务量过大，对底层的分布式存储系统性能也会有所要求，分布式存储是具有合理的分布架构，可以帮助企业进行扩展弹性计算。
3. 数据一致性：传统的存储架构使用RAID模式来保护数据的安全，而分布式存储则是用多副本备份的机制来保持数据一致性，在用户存储数据时，会对数据进行分片，把分片之后的数据在集群节点上保存。分布式存储采用的是一个副本写入，而其他的副本则是读取，在数据读取失败的时候，系统能从其他的副本中读取数据，并继续写入该副本，保证了副本总数的一致性，不过数据长时间处于不一致的情况，系统会自动重建和恢复，会将企业的业务影响降到最低。
4. 高性能：分布式存储能够有效的管理读写缓存，能够自行分级存储。写缓存技术配合高速存储，能够使整体存储得到性能提高，将热点区域内的数据直接映射到高速存储中，这样可以更好的提高系统的响应速度。

## Artifactory部署
```
下载
    https://jfrog.com/download-jfrog-platform/
    https://www.jfrog.com/confluence/
    https://www.jfrog.com/confluence/display/JFROG/Installing+Artifactory#InstallingArtifactory-DockerComposeInstallation
docker安装
    vim docker-compose.yml
        version: "3"
        services:
          my_artifactory:
            container_name: my_artifactory
            image: releases-docker.jfrog.io/jfrog/artifactory-oss:latest
            restart: always
            ports:
              - "8081:8081"
              - "8082:8082"
            volumes:
              - ./artifactory:/var/opt/jfrog/artifactory
              - /etc/localtime:/etc/localtime:ro

artifactory-pro
    vim docker-compose.yml
        version: "3"
        services:
          my_artifactory:
            container_name: my_artifactory
            image: releases-docker.jfrog.io/jfrog/artifactory-pro:6.6.0
            restart: always
            ports:
              - "8081:8081"
              - "8082:8082"
            volumes:
              - ./artifactory:/var/opt/jfrog/artifactory
              - /etc/localtime:/etc/localtime:ro

    破解包
        artifactory-injector-1.1.jar：https://gitee.com/g7go/chenjimblog/blob/master/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/data/artifactory/artifactory-injector-1.1.jar
        移动文件至挂载目录 /opt/jfrog/artifactory
        java -jar artifactory-injector-1.1.jar
            【2】
            【/opt/jfrog/artifactory】
            【yes】
            【1】

初始账号密码：
    admin/password
```

## Minio部署
```
官网
    https://min.io/
    http://minio.org.cn/

普通安装
    下载：wget https://dl.min.io/server/minio/release/linux-amd64/minio
    将下载的文件变成可执行   chmod +x minio
    启动：./minio server /data         不设置密码就是默认 minioadmin/minioadmin

docker安装
    vim docker-compose.yml
        version: "3"
        services:
          my_minio:
            container_name: my_minio
            image: minio/minio
            restart: always
            ports:
              - "9000:9000"
              - "9001:9001"
            volumes:
              - ./data:/data
              - /etc/localtime:/etc/localtime:ro
            environment:
              - MINIO_ROOT_USER=admin
              - MINIO_ROOT_PASSWORD=admin123
            command: server --console-address ':9001' /data
            privileged: true

用户权限设置
    {
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Action": [
                    "s3:GetBucketLocation",
                    "s3:GetObject",
                    "s3:ListBucket"
                ],
                "Resource": [
                    "arn:aws:s3:::t5100a",
                    "arn:aws:s3:::t5100a/*"
                ]
            }
        ]
    }

mc客户端下载
    curl https://dl.min.io/client/mc/release/linux-amd64/mc -o mc

mc客户端配置
    mc config host add minio http://192.168.159.128:9000 admin admin123

mc客户端使用
    ls       列出文件和文件夹。
    mb       创建一个存储桶或一个文件夹。
    cat      显示文件和对象内容。
    pipe     将一个STDIN重定向到一个对象或者文件或者STDOUT。
    share    生成用于共享的URL。
    cp       拷贝文件和对象。
    mirror   给存储桶和文件夹做镜像。
    find     基于参数查找文件。
    diff     对两个文件夹或者存储桶比较差异。
    rm       删除文件和对象。
    events   管理对象通知。
    watch    监视文件和对象的事件。
    policy   管理访问策略。
    config   管理mc配置文件。
    update   检查软件更新。
    version  输出版本信息。

    参数信息：
        --debug：调试
        --json：输出json格式
        --config-dir：配置文件路径

    举例：
        测试是否连通：mc admin info minio
        创建桶或目录：mc mb minio/mybucket
        文件列表：mc ls minio -r
        文件拷贝：mc cp xxx.tgz minio/t5100a
        文件删除或桶删除：mc rm minio/t5100a/xxx.tgz
        列出文件共享列表：mc share list download minio
        共享文件（无需key和secret key）：mc share download --expire 4h minio/t5100a/sign_key.tar.gz
        镜像同步：mc mirror minio/t5100a .
        文件查找：mc find minio --name "*.tar.gz"
        比较文件：mc diff . minio/t5100a
        显示公开的权限列表：mc anonymous list minio/t5100a
        获取权限：mc anonymous get minio/t5100a
        设置权限：mc anonymous set [none|download] minio/t5100a

mc admin命令
    service - 重新启动和停止所有MinIO服务器
    update - 更新所有MinIO服务器
    info - 显示MinIO服务器信息
    user - 管理用户
    group - 管理组
    policy - 管理固定政策
    config - 管理服务器配置文件
    heal - 修复MinIO服务器上的磁盘，存储桶和对象
    profile - 生成用于调试目的的配置文件数据
    top - 为MinIO提供类似顶部的统计信息
    trace - 显示MinIO服务器的http跟踪
    console - 显示MinIO服务器的控制台日志
    prometheus - 管理prometheus配置设置

    举例：
        测试是否连通：mc admin info minio
        显示策略：mc admin policy list minio
        mc admin user list minio
        mc admin group list minio
```