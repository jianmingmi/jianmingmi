---
uuid: b9235f40-bce1-11ed-9b3d-9732a4daf7db
title: Sonic云真机平台
date: 2023-3-7
tags:
  - Linux
categories:
  - Linux
abbrlink: f2ad2d85
---

Sonic云真机平台

<!--more-->

## 官方地址

[sonic-cloud](https://sonic-cloud.cn/)
[github](https://github.com/SonicCloudOrg)
[社区](https://sonic-cloud.wiki/)

## 介绍

Sonic是一款开源、支持分布式部署、在线自动化测试的私有云真机平台。
一站式开源分布式集群云真机测试平台，致力服务于中小企业的客户端UI测试。
Sonic当前的愿景是能帮助中小型企业解决在客户端自动化或远控方面缺少工具和测试手段的问题。

## 效果展示

![](/images/2023-3-7Sonic云真机平台/2023-3-7Sonic云真机平台1.png)
![](/images/2023-3-7Sonic云真机平台/2023-3-7Sonic云真机平台2.png)
![](/images/2023-3-7Sonic云真机平台/2023-3-7Sonic云真机平台3.png)

## 云真机平台对比

|  | 公共  | 私有  |
|  ----  | ----  | ----  |
| 平台 | testin云测、Testbird、腾讯的WeTest、优测、阿里的EMAS、百度MTC | Sonic、ATX-Server2、STF |
| 特点 | 面向各大企业或个人 | 私有化部署、面向企业内部 |
| 优点 | 机型覆盖全，功能丰富，如：APP性能监控、自动化测试 | 开源、免费 |
| 缺点 | 收费高 | 自建成本高，尤其是真机采购费用 |

## 云真机平台能够解决的问题
* 兼容性测试：需接入一定数量、具有代表性的测试机资源；
* 自动化测试：平台本身自带自动化测试能力，也可以自己写代码、连接真机运行测试；
* 测试机资源紧张：云真机平台都秉承着用完即走的设计理念，因此使用完退出后，下一个登录用户可以接着使用，一定程度上能够解决研发团队内测试机资源紧张的问题；
* 远程演示：如验收测试或是客户演示过程中，手机和电脑无法实时投屏在同一个显示器或电视等外接设备，这是只需要在已投屏的电脑上登录远程真机地址即可实时访问，方便同步观看；
* 测试数据共享不便问题：测试过程中，有时需要在一个历史版本上验证回溯问题，云真机可以安装历史版本的APP，并提前预置好测试数据，以便共享使用；

## 功能特性

![](/images/2023-3-7Sonic云真机平台/2023-3-7Sonic云真机平台4.jpg)

## Sonic架构

![](/images/2023-3-7Sonic云真机平台/2023-3-7Sonic云真机平台5.jpg)


## 部署

### 前后端

准备工作：docker-compose、Docker、MySQL

1. 创建一个MySQL数据库，数据库名可自定义，注意字符集为 utf8，排序规则为 utf8_general_ci。如果你想MySQL随着Sonic一同启动（不推荐），可以参考本页下方在docker-compose.yml中内置MySQL的内容。
2. [点击这里](https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-server/releases/download/v2.3.2/sonic-server-v2.3.2.zip) 下载最新版本的 zip 文件到任意目录（如加速链接失效，请自行前往 [这里](https://github.com/SonicCloudOrg/sonic-server/releases) 下载）。
3. 解压 zip，更改.env 中的信息。（无需改动 docker-compose.yml 文件。env 配置项内容可查看下方表格。如果您的系统没显示.env，在本页最下方【常见问题】查看解决方案）
4. 当前目录下执行以下指令``docker-compose up -d``

```
如果您为中国大陆用户，出现访问DockerHub较慢的情况，可以从以下两点选择一个进行操作：

配置国内加速镜像源（推荐）
执行以下指令直接使用加速镜像（不推荐，加速源可能出现不稳定或网络波动，后续down的时候需要docker-compose -f docker-compose-zh.yml down）
docker-compose -f docker-compose-zh.yml up -d
```

5. 前后端部署完毕！（因 Eureka 心跳机制，刚启动完毕微服务间互相访问需要 3~5 分钟，请耐心等候）打开浏览器访问 http://localhost:3000，然后可 直接前往 Agent 端部署。
6. （附）如果您是经验丰富的运维人员，也可以前往 Eureka 页面查看各微服务状态。

### Agent 端部署

```
注意
谨记一个主机只能部署一个 Agent 端，每个 Agent 的 Key 不能重复使用，多台设备可接入同一 Agent。
为了能正常使用，请保持与server版本一致。
考虑到远控时带宽消耗以及数据传输速度等场景，建议 Agent 优先使用有线网络环境而不是无线网络。
```

jar 方式部署
该方式将以本地 jar 包部署 Agent 端、Appium 等等环境。

1. 已知部分 JDK 出现不兼容的问题，Sonic 官方推荐使用 JDK15，可以前往 这里 安装下载。
2. 从部署好的前端界面【设备中心】的【Agent 中心】新增 Agent，记录 Agent 的 Key。
3. （如不需要接入安卓设备可跳过）将安卓 SDK 设置到系统环境变量，命名为 ANDROID_HOME。打开 SDKManager，下载 platform-tools。确保 platform-tools 目录存在，adb 指令可用。
4. 将 ANDROID_HOME、ANDROID_HOME/platform-tools 添加到系统 PATH 中。
5. 选择 PC 对应的平台 zip 下载并解压到任意目录（标记为 工作目录 ，如以下加速链接失效，请自行前往 [这里](https://github.com/SonicCloudOrg/sonic-agent/releases) 下载）
6. 赋予 工作目录 所有权限，然后确保解压后的 mini、config、plugins 文件夹与 jar 同级
``sudo chmod -R 777 xxxxx``
然后可以列出文件夹检查一下。
```
$ cd xxxxx
$ tree

# ├─sonic-agent-xxxx.jar
# │
# ├─config
# │   ├─application-sonic-agent.yml
# ├─plugins
# ├─mini
```
7. 修改 config 文件夹中 application-sonic-agent.yml 的配置信息，保存。
8. 在 工作目录 路径下执行以下指令。
```
TIP
注意！如果你是 windows 用户，请先在控制台输入 chcp 65001 并回车，再输入以下指令
java -Dfile.encoding=utf-8 -jar sonic-agent-xxxx.jar
```
9. 部署完毕！自行插入设备即可（设备请竖直放置或平摊放置，左右旋转放置有可能影响坐标定位）。
