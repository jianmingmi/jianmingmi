---
uuid: 105c01e1-bcd3-11ed-abae-3fce2bc8128b
title: 服务器被攻击勒索案例
date: 2017-9-27
tags:
  - Linux
abbrlink: c41bb58
---

服务器被攻击勒索案例

<!--more-->

## 背景
``2017-9-27``，服务器数据库端口3306被嗅探攻击，由于未设防火墙，且未设置安全策略。数据被转移、密码被修改。

## 勒索数据

```
Hello,

I am a security researcher from Sweden, 
having interest on web security and other focus areas.

Your database "mm_wiki" was breached by a 3rd party and
files were backed up to their cloud hosting storage.

I accidently discovered this dedicated cloud storage and was able to secure the files.

It is scheduled to be sold online.

The short-term consequences of this data leak could be fees, fines and frustration.

To prevent this i will remove all files from online storage above
and restore the database if needed.

    please send exactly 0.1 bitcoin (BTC) to the following 
    bitcoin address: 1JekXdQGREcfKp3dAuaLTRs9XbTVxczq2V

email me after the payment confirms(about an hour),
and I email you back the link to download the original 
dump file mm_wiki.sql.gz created with mysql mydumper.

I will shred the files and terminate their cloud hosting account in 24hrs after the payment.

incidentId: 1eaa480d-bd6d-44f7-a2b1-2204b32049d9
email: 0b1f61b3e0d3@mailinator.com



To buy bitcoin instantly you can use paxful.com like services.

incidentId: 1eaa480d-bd6d-44f7-a2b1-2204b32049d9
email: 0b1f61b3e0d3@mailinator.com



database summary:

* total tables count: 17
* total approx. documents count for all tables: 388

table: "mw_log" => 127 documents
table: "mw_privilege" => 92 documents
table: "mw_log_document" => 88 documents
table: "mw_role_privilege" => 30 documents
table: "mw_document" => 20 documents
.......................

full database dump file: mm_wiki.sql.gz, about 0.29 MB.

* system/stat/views/functions/triggers or other special tables not counted.
    these numbers for reference only.
    binary format, total size depends on zlib compression ratio, data sparsity.

incidentId: 1eaa480d-bd6d-44f7-a2b1-2204b32049d9
email: 0b1f61b3e0d3@mailinator.com
```

## 服务器防范措施

- 1)服务器设置大写、小写、特殊字符、数字组成的12-16位的复杂密码 ，也可使用密码生成器自动生成复杂密码，这里给您一个链接参考：https://suijimimashengcheng.51240.com/
- 2)删除服务器上设置的不需要的用户
- 3)对于不需要登录的用户，请将用户的权限设置为禁止登录
- 4)修改远程登录服务的默认端口号以及禁止超级管理员用户登陆
Windows远程端口修改参考文档：https://cloud.tencent.com/developer/article/1052163
Linux远程端口修改参考文档：https://cloud.tencent.com/developer/article/1124500
- 5)较为安全的方法：只使用密钥登录禁止密码登陆 （针对Linux系统）
- 6)腾讯云平台有安全组功能，里面您只需要放行业务协议和端口，不建议放行所有协议所有端口，参考文档： https://cloud.tencent.com/document/product/215/20398
- 7)不建议向公网开放核心应用服务端口访问，例如mysql、redis等，您可修改为本地访问或禁止外网访问
- 8)如果您的本地外网IP固定，建议使用安全组或者系统防火墙禁止除了本地外网IP之外所有IP的登录请求
需注意：做好云服务器系统的安全防护可以有效加强云服务器系统安全， 但也无法保证绝对安全， 建议定期做好云服务器系统的安全巡检及数据备份，以防突发情况导致数据丢失、或业务不可用。
- 9)企业级服务器，应购买企业级防火墙，动态日志、监控、预警、防护措施，针对来访地址和数据，调整防火墙规则。


## 日常查看和维护

- 定期修改密码``passwd``
- 查看用户登录情况``who、who am i``
- 查看用户登录信息``last``
- 查看各个用户登录信息``lastlog``
- 查看登录失败信息``lastb``，这个可以查看嗅探的IP，以此来禁用
- 查看用户命令历史``history``
- 日志和监控``ELK、Prometheus``