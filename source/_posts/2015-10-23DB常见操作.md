---
uuid: 105bdad0-bcd3-11ed-abae-3fce2bc8128b
title: DB常见操作
date: 2015-10-23
tags: [Database]
---

DB常见操作

<!--more-->

## 命令
```
DDL：数据定义语言
DQL：数据查询语言
DML：数据操作语言
CREATE：创建一个新的表，一个表的视图，或者数据库中的其他对象。
ALTER：修改数据库中的某个已有的数据库对象，比如一个表。
DROP：删除整个表，或者表的视图，或者数据库中的其他对象。
INSERT：创建一条记录。
UPDATE：修改记录。
DELETE：删除记录。
SELECT：从一个或多个表中检索某些记录。
```


## 运算符

```
算术运算符
    +：加法 - 把运算符两边的值相加	a + b 将得到 30
    -：减法 - 左操作数减去右操作数	a - b 将得到 -10
    *：乘法 - 把运算符两边的值相乘	a * b 将得到 200
    /：除法 - 左操作数除以右操作数	b / a 将得到 2
    %：取模 - 左操作数除以右操作数后得到的余数	b % a will give 0

比较运算符
    ==：检查两个操作数的值是否相等，如果相等则条件为真。	(a == b) 不为真。
    =：检查两个操作数的值是否相等，如果相等则条件为真。	(a = b) 不为真。
    !=：检查两个操作数的值是否相等，如果不相等则条件为真。	(a != b) 为真。
    <>：检查两个操作数的值是否相等，如果不相等则条件为真。	(a <> b) 为真。
    >：检查左操作数的值是否大于右操作数的值，如果是则条件为真。	(a > b) 不为真。
    <：检查左操作数的值是否小于右操作数的值，如果是则条件为真。	(a < b) 为真。
    >=：检查左操作数的值是否大于等于右操作数的值，如果是则条件为真。	(a >= b) 不为真。
    <=：检查左操作数的值是否小于等于右操作数的值，如果是则条件为真。	(a <= b) 为真。
    !<：检查左操作数的值是否不小于右操作数的值，如果是则条件为真。	(a !< b) 为假。
    !>：检查左操作数的值是否不大于右操作数的值，如果是则条件为真。	(a !> b) 为真。

逻辑运算符
    AND：运算符允许在一个 SQL 语句的 WHERE 子句中的多个条件的存在。
    BETWEEN：运算符用于在给定最小值和最大值范围内的一系列值中搜索值。
    EXISTS：运算符用于在满足一定条件的指定表中搜索行的存在。
    IN：运算符用于把某个值与一系列指定列表的值进行比较。
    NOT IN：运算符的对立面，用于把某个值与不在一系列指定列表的值进行比较。
    LIKE：运算符用于把某个值与使用通配符运算符的相似值进行比较。
    GLOB：运算符用于把某个值与使用通配符运算符的相似值进行比较。GLOB 与 LIKE 不同		之处在于，它是大小写敏感的。
    NOT：运算符是所用的逻辑运算符的对立面。比如 NOT EXISTS、NOT BETWEEN、NOT IN，等等。它是否定运算符。
    OR：运算符用于结合一个 SQL 语句的 WHERE 子句中的多个条件。
    IS NULL：运算符用于把某个值与 NULL 值进行比较。
    IS：运算符与 = 相似。
    IS NOT：运算符与 != 相似。
    ||：连接两个不同的字符串，得到一个新的字符串。
    UNIQUE：运算符搜索指定表中的每一行，确保唯一性（无重复）。

位运算符
    &：如果同时存在于两个操作数中，二进制 AND 运算符复制一位到结果中。	(A & B) 将得到 		12，即为 0000 1100
    |：如果存在于任一操作数中，二进制 OR 运算符复制一位到结果中。	(A | B) 将得到 61，即	为 0011 1101
    ~：二进制补码运算符是一元运算符，具有"翻转"位效应，即0变成1，1变成0。	(~A ) 将得到 	-61，即为 1100 0011，一个有符号二进制数的补码形式。
    <<：二进制左移运算符。左操作数的值向左移动右操作数指定的位数。	A << 2 将得到 240，即	为 1111 0000
    >>：二进制右移运算符。左操作数的值向右移动右操作数指定的位数。	A >> 2 将得到 15，即为 0000 1111
```

## 基本用法

```
执行顺序：
    1.from
    2.join
    3.where
    4.group by
    5.order by

增删改查
    insert into `user`(`field1`,`field2`) values(value1,value2);
    delete from `user` where 范围;
    update `user` set field1=value1 where 范围;
    select * from `user`;

like子句
    select * from `user` where name like 'xxx%';
    select * from `user` where name like 'xxx_';
    通配符：百分号（%）代表零个、一个或多个数字或字符。下划线（_）代表一个单一的数字或字符。

glob子句
    select * from `user` where name glob 'xxx*';
    select * from `user` where name glob 'xxx?';
    通配符：星号（*）代表零个、一个或多个数字或字符。问号（?）代表一个单一的数字或字符。

limit子句（从 offset 偏移量，截取 limit 条数）
    select * from `user` limit 10 offset 0;

order by子句
    select * from `user` order by col1,col2 [ASC | DESC];

group by子句
    select * from `user` group by col1,col2 having 条件;

distinct（去除重复列，distinct后面的所有列）
    select distinct col1,col2,col3 from `user`;
```

## 高级
```
约束：
    not null 约束：确保某列不能有 NULL 值。
    default 约束：当某列没有指定值时，为该列提供默认值。
    unique 约束：确保某列中的所有值是不同的。
    primary key 约束：唯一标识数据库表中的各行/记录。
    check 约束：CHECK 约束确保某列中的所有值满足一定条件。
    age ingeter check(age > 0),

连接：
    交叉连接 - CROSS JOIN（结果乘积）
    内连接 - INNER JOIN（结果交集）
    外连接 - OUTER JOIN（left、right）（on只对关联条件起作用）
        select * from t1 a
        left join t2 b on a.id = b.user_id

union：（union连接两个结果集，union all包括重复列）
    select * from user1
    union
    select * from user2

别名：
    select a as name from user as A
    select a name from user A

触发器：

索引：
    create index index_name on table_name (column1, column2);
    drop index salary_index;
    select * from company indexed by salary_index WHERE salary > 5000;

视图：
    create view xxx_view as select * from `user`;
    drop view xxx_view;

事务：
    BEGIN TRANSACTION：开始事务处理。
    COMMIT：保存更改，或者可以使用 END TRANSACTION 命令。
    ROLLBACK：回滚所做的更改。
    事务控制命令只与 DML 命令 INSERT、UPDATE 和 DELETE 一起使用。他们不能在创建表或删除表时使用，因为这些操作在数据库中是自动提交的。

autoincrement：
    column1 integer autoincrement,

集合判断：
    (case 
    when A.status_flag='0' then '退回' 
    when A.status_flag='1' then '新增' 
    when A.status_flag='2' then '待复核' 
    else '其他' 
    end
    ) status_name

函数：
    1：SQLite COUNT 函数
        SQLite COUNT 聚集函数是用来计算一个数据库表中的行数。
    2：SQLite MAX 函数
        SQLite MAX 聚合函数允许我们选择某列的最大值。
    3：SQLite MIN 函数
        SQLite MIN 聚合函数允许我们选择某列的最小值。
    4：SQLite AVG 函数
        SQLite AVG 聚合函数计算某列的平均值。
    5：SQLite SUM 函数
        SQLite SUM 聚合函数允许为一个数值列计算总和。
    6：SQLite RANDOM 函数
        SQLite RANDOM 函数返回一个介于 -9223372036854775808 和 +9223372036854775807 之间的伪随机整数。
    7：SQLite ABS 函数
        SQLite ABS 函数返回数值参数的绝对值。
    8：SQLite UPPER 函数
        SQLite UPPER 函数把字符串转换为大写字母。
    9：SQLite LOWER 函数
        SQLite LOWER 函数把字符串转换为小写字母。
    10：SQLite LENGTH 函数
        SQLite LENGTH 函数返回字符串的长度。
    11：SQLite sqlite_version 函数
        SQLite sqlite_version 函数返回 SQLite 库的版本。
            
```

## Mysql常用操作

```
mysql数据类型
    | 类型 | 描述 |
    | int/integer | int同integer |
    | char | 定长字符串 |
    | varchar | 变长字符串 |
    | text | 长文本 |

创建表（可放not null和default）
    drop table if exists `user`;
    create table `user` (
     `id` int auto_increment,
     `name` varchar(32),
     `age` int,
     primary key (`id`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

连接mysql，并修改密码
    mysql -u root -p
    set password for 'root'@'localhost' = password('newpass');

创建删除数据库
    drop database `jfinal`;
    create database `jfinal` CHARACTER SET utf8 COLLATE utf8_general_ci;

修改root密码
    use mysql;
    update user set password=password('new password') where user='root';

创建远程用户（删除、创建、授权）
    drop user 'jmm'@'%';
    create user 'jmm'@'%' identified by 'jmm';
    grant all on *.* to 'jmm'@'%';

查看用户
    select Host,User from mysql.user;

查看 设置 字符集
    show VARIABLES like 'character%';
    set character_set_client=utf8;
```

## sqlite常用操作

```
创建表
    drop table if exists `user`;
    create table if no exists `user` (
     id integer primary key,    -- integer primary key即为自增
     name varchar(32),
     age integer
    );

查表信息
    select name from sqlite_master;

查询出某个表的所有字段信息
    PRAGMA table_info([tablename]);
```

## 其他
```
sql  操作

一.sql语句
  
	增	insert into user (id,name,sex) values (1,'王明',1)
	删	delete from user where id = 1
	改	update user set name='张',sex=1 where id = 1
	查	select * from user where name like %'张'% limit 0,10

二.JDBC操作
      
	================================数据库操作，五步==========================
	
	//1.加载驱动
	Class.forName("com.mysql.jdbc.Driver");

	//2.连接数据库
	Connection connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/数据库名?useUnicode=true&characterEncoding=utf-8","用户","密码");

	//3.使用Connection创建语句
	String sql = "select * from user";
	PreparedStatement pst = connection.prepareStatement(sql);
	
	//4.执行
	ResultSet rs = pst.executeQuery();//查询
	ResultSet rs = pst.executeUpdate();//增删改

	/*
	while(rs.next()){
		int id = rs.getInt("id");
		String name = rs.getString("name");
		String pwd = rs.getString("pwd");
	}
	*/
	
	//5.关闭数据，从下到上
	rs.close();
	pst.close();
	connection.close();

	======================================结束=======================================
	

三.读取配置文件信息（database.properties）（单例模式）


//读取配置文件的工具类-单例模式

public class ConfigManager {
	private static ConfigManager configManager;
	private static Properties properties;
	
	//私有构造器
	private ConfigManager(){
		String configFile = "database.properties";
		properties = new Properties();
		//通过classpath找资源
		InputStream is = ConfigManager.class.getClassLoader().getResourceAsStream(configFile);
		try {
			properties.load(is);
			is.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	/*
	 * 
	 * 线程不安全，在并发的情况下，很有可能会出现多个ConfigManager实例
	 * 考虑同步,可以采用synchronized
	 * 
	 * */
	//全局访问点
	public static synchronized ConfigManager getInstance(){
		if(configManager == null){
			configManager = new ConfigManager();
		}
		return configManager;
	}
	
	public String getValue(String key){
		 return properties.getProperty(key);
	}
}

	
	//用key取出properties里面的value
	String driver = ConfigManager.getInstance().getString("driver");
	String url = ConfigManager.getInstance().getString("url");
	String user = ConfigManager.getInstance().getString("user");
	String pwd = ConfigManager.getInstance().getString("pwd");
```