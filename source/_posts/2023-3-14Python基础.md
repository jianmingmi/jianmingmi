---
uuid: 9320c9a1-bd7b-11ed-b917-3f894c2e238b
title: Python基础
date: 2023-3-14
tags:
  - Python
abbrlink: 99832f47
---

Python基础

<!--more-->

## 基础语法
```
1.变量
    1.1 变量通常是大写字母、下划线连接。可以由数字、字母、下划线组成，但不能以数字开头
    1.2 变量数据类型：
        1.2.1 Numbers（数字）
            int（有符号整型）
            long（长整型[也可以代表八进制和十六进制]。python3中被移除）
            float（浮点型）
            complex（复数）
        1.2.2 String（字符串）
        1.2.3 List（列表）
        1.2.4 Tuple（元组）
        1.2.5 Dictionary（字典）
    1.3 数据类型转换
        int(x [,base])：将x转换为一个整数
        str(x)：将对象 x 转换为字符串

    1.5 三元运算符
        index = 1 if flag == False else 2

    1.4 字符串
        str = "Hello"
        str += " world"（拼接）
        'name is {}, age is {}'.format('jmm', 30)（拼接）
        'name is %s, age is %d' % ('jmm', 30)（拼接）

        len(str)（长度）
        str[0]（截取，输出第一个）
        str[1:3]（截取，输出[1,3)）
        str[1:]（截取，输出[1,∞)）
        str[:1]（截取，输出[0,1)）
        str[::-1]（截取，输出[0,1)）

        str.replace('o', '8')（字符串替换）

        str.startswith('asdf')（是否以什么开头）

        if str.find('ll') != -1:（字符串查找）
            print('查找ll位置', str.find('ll'))

        str.split(',')（字符串分割）
        str.strip()（去首尾，lstrip去左边，rstrip去右边）

        str.upper()（转换为大写）
        str.lower()（转换为小写）

    1.4 list
        list = ['qqq', 'www', 'eee', 'rrr', 'aaa']
        list1 = [123, 'john']

        list + list1（拼接）
        len(list)（长度）

        # 截取
        list[0]（截取，截取第一个）
        list[1:3]（截取，截取[1,3)）
        list[2:]（截取，截取[2,∞)）
        list[:2]（截取，截取[0,2)）
        ids = list(set(ids))（去重）
        ','.join(list)（list转string）

        list.pop(2)（删除元素 2）
        list.insert(2, 'aa')（新增元素）

        if 'qwer' in list:（查找）
            print('查找元素', 'qwer')

        list.copy()（深度拷贝）

        # sort在原列表上排，sorted生成新列表
        list.sort(reverse=False)（排序，升序）
        list.sort(key=lambda x: x[1], reverse=False)（排序，选择字段）

        list.reverse()（倒序）

        for i in range(len(list) - 1, -1, -1):（按下标逆序）
            print(i)

        for var in list[::-1]:（删除元素，逆序）
            if var == 'aaa':
                list.remove(var)

        for var in list:（遍历1）
            pass

        # 遍历2（[)，range是左闭右开）
        for i in range(0, len(list)):（遍历2，[)，range是左闭右开）
            pass

        # 列表拼接
        list1.extend(list2)

    1.4 dict
        dict = {}

        dict['1'] = "aaa"
        dict[2] = "sss"
        dict['3'] = "ddd"
        dict['4'] = "fff"

        dict['1']（输出键为one的值）
        dict[2]（输出键为 2 的值）

        if '1' in dict.keys():（查找是否有key）
            print('查找是否有1')

        dict.pop(2)（删除元素 2）

        dict.copy()（深度拷贝）

        sorted(d.items(), lambda x, y: cmp(x[1], y[1]), reverse=True)（排序）

        {**build_params, **test_params}（字典合并）

        for k, v in dict.items():（字典遍历1）
            pass

        for k in dict.keys():（字典遍历2）
            pass

2.运算符
    2.1 运算符种类：算术运算符、比较运算符、赋值运算符、逻辑运算符、位运算符、成员运算符、身份运算符
    2.2 算数运算符：+、-、*、/、%（取余）、**（返回x的y次幂）、//（取整除，取余留下的数）
    2.3 比较运算符：==、!=、>、<、>=、<=
    2.4 赋值运算符：=、+=、-=、*=、/=、%=、**=、//=
    2.5 逻辑运算符：and、or、not
    2.6 位运算符：&（按位与）、|（按位或）、^（按位异或）、~（按位取反）、<<（左移）、>>（右移）
    2.7 成员运算符：in、not in
    2.8 身份运算符：is、is not


3.流程控制
    3.1 if语句
        if a > b:
            print("a > b")
        elif a > b:
            print("a > b")
        else:
            print("a = b")

    3.2 for循环
        for letter in 'Python':     # 第一个实例
            print '当前字母 :', letter

        list = ['banana', 'apple',  'mango']
        for var in list:        # 第二个实例
            print '当前水果 :', var

        list = ['banana', 'apple',  'mango']
        for index in range(len(list)):
            print '当前水果 :', list[index]

    3.3 while循环
        count = 0
        while (count < 9):
           print 'The count is:', count
           count = count + 1

        无限循环：
        while True :  # 该条件永远为true，循环将无限执行下去
           num = raw_input("Enter a number  :")
           print "You entered: ", num

4.函数和类
    4.1 函数
        4.1.1 函数：必备参数
            def printme(str):
                print str
                return

            printme("haha")

        4.1.2 函数：关键字参数
            def printinfo(name, age):
                print "Name: ", name
                print "Age ", age
                return

            printinfo(age=50, name="miki")

        4.1.3 函数：默认参数
            def printinfo(name, age = 35):
                print "Name: ", name
                print "Age ", age
                return

            printinfo(age=50, name="miki")
            printinfo(name="miki")

        4.1.4 函数：不定长参数
            def printinfo(arg1, *vartuple):
                print arg1
                for var in vartuple:
                    print var
                return

            printinfo(10)
            printinfo(70, 60, 50)

        4.1.5 字典参数
            def haha(*args, **kwargs):
                print args
                print kwargs["ww"]
                pass

            haha(1, 2, "asd", ww="aa", qq="qq")

        4.1.6 匿名函数
            sum = lambda arg1, arg2: arg1 + arg2

            print "相加后的值为 : ", sum(10, 20)

        4.1.7 指定参数和返回类型
            def longestPalindrome(self, s: str) -> str:
                pass

    4.2 类
        4.2.1 类的创建
            class Employee:
               # 类变量，唯一、静态
               empCount = 0

               def __init__(self, name, salary):
                  self.name = name # 对象变量，属于对象
                  self.salary = salary
                  Employee.empCount += 1

            # 创建对象
            emp1 = Employee("Zara", 2000)
            emp2 = Employee("Manni", 5000)

            类的调用
                c = Child()          # 实例化子类
                c.childMethod()      # 调用子类的方法
                c.parentMethod()     # 调用父类方法
                c.setAttr(200)       # 再次调用父类的方法 - 设置属性值
                c.getAttr()          # 再次调用父类的方法 - 获取属性值

            Python内置类属性
                __file__：当前文件名
                __del__ : 析构函数
                __dict__ : 类的属性（包含一个字典，由类的数据属性组成）
                __doc__ :类的文档字符串
                __name__: 类名
                __module__: 类定义所在的模块（类的全名是'__main__.className'，如果类位于一个导入模块mymod中，那么className.__module__ 等于 mymod）
                __bases__ : 类的所有父类构成元素（包含了一个由所有父类组成的元组）

            注：self 代表类的实例，self 在定义类的方法时是必须有的，虽然在调用时不必传入相应的参数。不是 python 关键字，我们把他换成 runoob 也是可以正常执行的
            注：_foo: 以单下划线开头的表示的是 protected 类型的变量
            注：__foo: 双下划线的表示的是私有类型(private)的变量


        4.2.2 类的继承
            class Parent:  # 定义父类
                parentAttr = 100  # 全局静态变量

                def __init__(self):
                    print('调用父类构造函数')

                def __del__(self):
                    print('调用父类析构函数')

                def parentMethod(self):
                    print('调用父类方法')

                def setAttr(self, attr):
                    Parent.parentAttr = attr

                def getAttr(self):
                    print('父类属性 :', Parent.parentAttr)


            class Child(Parent):  # 定义子类
                def __init__(self):
                    Parent.__init__(self)  # 显示调用父类构造方法，不然被重写
                    print('调用子类构造方法')

                def __del__(self):
                    print('调用子类析构函数')
                    Parent.__del__(self)

                def childMethod(self):
                    print('调用子类方法')

        4.2.3 枚举
            # 导入枚举类
            from enum import Enum

            # 继承枚举类
            class color(Enum):
                YELLOW  = 1
                BEOWN   = 1
                # 注意BROWN的值和YELLOW的值相同，这是允许的，此时的BROWN相当于YELLOW的别名
                RED     = 2
                GREEN   = 3
                PINK    = 4
```


## python和pip安装
```
python
    安装：sudo apt install python3

    运行
        python3 xxx.py
            -u：不带缓存输出
            -m：模块当做脚本运行
            -i：镜像源
            -c：允许cmd，例如：ssh -p 29418 jiajia1.tang@review.sonyericsson.net gerrit query --format=JSON --commit-message 784742  --current-patch-set | sed '2d' | python -c 'import json;import sys;print json.loads(sys.stdin.readline(),"UTF-8")["currentPatchSet"]["number"]'
pip
    安装：sudo apt install python3-pip

    查看所有库：pip3 list
    升级pip：pip3 install --upgrade pip
    安装库：pip3 install requests=[版本号] -i https://pypi.tuna.tsinghua.edu.cn/simple
    卸载并重装pip：sudo python3 -m pip uninstall pip && sudo apt install python3-pip --reinstall

库安装
    1.离线安装
        python install setup.py
    2.pip安装
        pip3 install requests=[版本号] -i https://pypi.tuna.tsinghua.edu.cn/simple
    3.idea安装
        Settings -> Project: script -> Project Interpreter

python库地址
    https://www.lfd.uci.edu/~gohlke/pythonlibs
```

## 设置镜像源
```
ubuntu：
    vim ~/.pip/pip.conf
        [global]
        index-url = https://pypi.tuna.tsinghua.edu.cn/simple

windows：
    C:\Users\xxx\pip\pip.ini
        [global]
        index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

## Pycharm设置
```
Settings -> Editor -> File Encodings -> UTF-8
Settings -> Editor -> Code Style -> Tab size 改成 4
Settings -> Project: script -> Project Interpreter -> 设置python版本
Settings -> Project: script -> Project Interpreter -> 点+号，设置镜像源（https://pypi.tuna.tsinghua.edu.cn/simple）
```

## 生成包依赖
```
安装
    pip3 install pipreqs
生成
    pipreqs ./ --encoding=utf8
安装依赖
    pip3 install -rU requirements.txt
```

## 编译成可执行文件
```
安装
    pip3 install pyinstaller
生成
    pyinstaller -F xxx.exe（也可在linux环境中生成）
```

## 虚拟环境
```
linux
    mkdir myproject
    cd myproject
    python3 -m venv venv
    . venv/bin/activate

windows
    mkdir myproject
    cd myproject
    py -3 -m venv venv
    venv\Scripts\activate
```

## 模块导入和使用
```
1. 在同一目录下:
    # 导入模块
        import support
    # 使用
        support.print_func('Runoob')
        print(support.count)

    # 导入模块内具体内容
        from support import print_func
        from support import count
    # 使用
        print_func('Runoob')
        print(count)

2. 子目录
    import os
    import sys
    sys.path.append(os.path.join(os.path.dirname(os.path.abspath(__file__)), 'sub_dir'))

3. 父目录
    import os
    import sys
    sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
```

## 默认解释器、编码
```
#!/usr/bin/python3
# encoding: utf-8
```

## Python引号
```
Python 可以使用引号( ' )、双引号( " )、三引号( ''' 或 """ ) 来表示字符串，其中三引号可以由多行组成。
word = 'word'
sentence = "这是一个句子。"
paragraph = """这是一个段落。
包含了多个语句"""
```

## is 与 == 区别
```
is 用于判断两个变量引用对象是否为同一个(同一块内存空间)， == 用于判断引用变量的值是否相等。
```

## 异常处理
```
捕获异常：
try:
    doxxx
except Exception as e:
    print(e)
    print(traceback.format_exc())

抛出异常：
raise Exception('haha')
```

## 全局变量
```
引用全局变量，不需要global声明，修改全局变量，需要使用global声明
```

## 解析参数
```
opts,args = getopt.getopt(sys.argv[1:],'hf:v',['help','filename=','version'])
for opt_name,opt_value in opts:
    if opt_name in ('-h','--help'):
        print("[*] Help info")
        sys.exit()
    if opt_name in ('-v','--version'):
        print("[*] Version is 0.01 ")
        sys.exit()
    if opt_name in ('-f','--filename'):
        fileName = opt_value
        print("[*] Filename is ",fileName)
        # do something
        sys.exit()
```

## 获取当前用户
```
import getpass
getpass.getuser()
```


## wheel包
```
安装
    pip3 install wheel
    pip3 install --upgrade setuptools

setup.py
    from setuptools import setup

    setup(
        name='webscm',
        version='1.0',
        py_modules='webscm'
    )

生成包
    python3 setup.py bdist_wheel

导入包
    pip3 install webscm-1.0-py3-none-any.whl

部署
    pip3 install waitress
    waitress-serve --call 'flaskr:create_app'
```


## url编码和解码
```
from urllib.parse import quote

# 将字符串‘程序设计’进行编码
text = quote("程序设计", 'utf-8')

# 对字符串‘%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1’进行解密
text = unquote("%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1", 'utf-8')
```


## 文件和文件夹
```
获取文件名和文件路径
    os.path.basename(__file__)
    os.path.dirname(__file__)

创建文件夹
    if not os.path.exists('out'):
        os.makedirs('out')

删除文件和文件夹
    删除文件，文件必须存在
        os.remove('xxx')
    删除文件夹，文件夹必须存在，文件夹为空
        os.rmdir('xxx')
    删除目录树，文件夹可不为空
        shutil.rmtree('xxx')

获取文件修改时间
    os.path.getmtime(file_name)

重命名
    os.rename(old, new)
```


## 查看依赖包地址
```
python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())"
```


## 列表推导
```
list comprehensions
tmp_list = [var['file_name'] for var in LONG_SAVE_FILE_LIST]
```


## lambda
```
lambda函数也叫匿名函数，即，函数没有具体的名称

先来看一个最简单例子：
    def f(x):
    return x**2
    print f(4)

Python中使用lambda的话，写成这样
    g = lambda x : x**2
    print g(4)
```

## 不带参数
```
def authenticate(func):
    @wraps(func)
    def wrap_func(*args, **kwargs):
        print(args, kwargs)
        # print(type(*args))
        return func(*args, **kwargs)

    return wrap_func


@authenticate
def addition_func(a, b, c, d):
    return 1
```

## 带参数
```
def check(key='', check=[]):
    def decorate_func(func):
        @wraps(func)
        def wrap_func(*args, **kwargs):
            print('args is : ', key, check)
            print('args is : ', args, kwargs)
            return func(*args, **kwargs)
        return wrap_func
    return decorate_func


@check(key='bbb', check=['111', '222', '333'])
def test(key, check):
    pass
```


## cpython打包
```
安装环境
    sudo apt install python3-dev gcc
    sudo pip3 install cython

编写setup.py
    from distutils.core import setup
    from Cython.Build import cythonize

    setup(ext_modules = cythonize(["mytest.py"]))

生成so
    python3 setup.py build_ext
```


## 安装mysqlclient
```
https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysqlclient
下载 mysqlclient-1.4.6-cp38-cp38-win32.whl
pip install mysqlclient-1.4.6-cp38-cp38-win32.whl
```


## 双括号
```
def test_two_parenthesis():
    def add(a,b):
        print(a+b)
    return add

def main():
    a = 1
    b = 2
    test_two_parenthesis()(a, b)
test_two_parenthesis()(a, b)。表示 test_two_parenthesis()函数返回了一个函数return add，并且返回的函数需要a和b两个参数
```

## ubuntu安装高版本python
```
安装python
    sudo apt-get install -y python-dev libffi-dev libssl-dev make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev

    wget https://www.python.org/ftp/python/3.8.5/Python-3.8.5.tar.xz
    tar xvf Python-3.8.5.tar.xz; cd Python-3.8.5
    ./configure --prefix=/usr/local/python3.8.5 && make && sudo make install
    sudo ln -s /usr/local/python3.8.5/bin/python3 /usr/local/bin/python3

安装pip
    wget --no-check-certificate  https://pypi.python.org/packages/source/s/setuptools/setuptools-19.6.tar.gz#md5=c607dd118eae682c44ed146367a17e26
    tar -zxvf setuptools-19.6.tar.gz; cd setuptools-19.6/

    python3 setup.py build; sudo python3 setup.py install
    sudo ln -s /usr/local/python3.8.5/bin/pip3 /usr/local/bin/pip3

    pip3 -V（验证是否是对应版本的python）

报错command not found：
    sudo vim /usr/lib/cnf-update-db
        #!/usr/bin/python3.6
```

## supervisor进程守护
```
sudo apt install supervisor
sudo vim /etc/supervisor/conf.d/django.conf
    [program:django]
    user=android
    command=bash -c "cd /home/android/service/WebSCM && /usr/local/python3.8.5/bin/daphne -b 127.0.0.1 -p 8091 core.asgi:application"
    autostart=true
    autorestart=true
    stderr_logfile=/home/android/service/WebSCM/django.output
    stdout_logfile=/home/android/service/WebSCM/django.output
    stopsignal=INT
sudo service supervisor restart（重启）
sudo service supervisor status（查看状态）
```