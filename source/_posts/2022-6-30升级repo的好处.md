---
uuid: 105c28f0-bcd3-11ed-abae-3fce2bc8128b
title: 升级repo的好处
date: 2022-6-30
tags:
  - Git
categories:
  - Git
abbrlink: 326964dc
---

升级repo的好处

<!--more-->

## Gerrit升级提示
升级Gerrit之后, 由于很多新feature只在新版的git和repo上得到支持. 已经不兼容过旧的git和repo版本. 
停止对python3.5以下,git版本在2.26.1和repo launcher 2.21以下的支持

届时, repo init和repo sync会在这些老版本的组件上报错.

## 如何升级?
### Ubuntu 17.04, 18.04(含)及以上
Ubuntu 18.04以上已经自带python3.6+的版本. 所以只需要升级git以及repo launcher即可

### Ubuntu 16.04(含)及以下
Ubuntu 16.04及以下的机器. 默认是python是3.5以下的, 所以除了18.04需要做的升级之外. 还需要升级python.
另外你只需要安装了python3.6+就可以, 即使默认还是在使用python2.7也不会有问题. (切了环境就很容易崩掉)

但是请务必注意, 升级python有可能造成系统组件的紊乱.发现很多官方都已经宣布不支持16.04以下的版本的, 比如很多apt源以及packages. 同时, 16.04以及以下的OS会遇到越来越多的麻烦.所以强烈建议还在使用16.04的朋友尽快升级到20.04以上的版本

## 这些组件升级了之后有哪些好处?

### 升级git
1. `git的fetch协议`, 已经有了更有效率的`protocol v2`. 这个协议在`git fetch`最开始的`refs advertised`阶段的提升尤为明显.尤其对于`platform/frameworks/base`这种动辄`40万refs`的大仓库
从`git 2.18`开始, `git`支持`protocol V2`,从`2.26`开始,` git`默认使用`protocol V2`
然而`Ubuntu 18.04`最高只能下载到`2.17`的`git`. 所以实际上, 几乎`80%`的研发使用的`git`版本过老
`Git`进阶这篇文档详细解释了`protocol V1`. 有兴趣的朋友可以和官方文档对照着一起看, 了解其中的原因 [Git protocol V2](https://git-scm.com/docs/protocol-v2)
2. `partial-clone`.这个功能可以极大改善我们的工程师下载大型仓库的体验. 根据实验我们下载大仓库的代码时间从2小时30分钟, 减少为45分钟左右. 提升极其巨大.
然而此功能也只能在`2.22`之后的版本才支持
3. `git-lfs`也是一个重要功能. 我们会逐步迁移binary过多的仓库到lfs上. 众所周知git本身并不适合处理`binary`, 以至于我们的git性能在各方面都大幅下降. 当我们迁移完毕之后, 版本过低的用户将无法下载到正常的文件.

### 升级repo launcher
1. 很多人使用的repo, 已经是2015年的了, 严重落后. 很多重要feature都未得到更新.比如partial-clone git-lfs, 以及新的push fetch的url分离 等等功能. 我们建议无论你使用的是什么版本的repo启动器, 都统一升级到最新版
2. `git-lfs`需要最新版本的launcher的支持, 否则upload将会出现一些问题

### 升级Python
1. 新版repo只支持`python3.6+`的版本. 所以我们需要更新python